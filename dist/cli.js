#!/usr/bin/env node
module.exports=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("errno")},function(e,t,r){"use strict";var a=r(3).version,n=r(4),s=r(5),o=s.validateFile,i=s.validateExample,l=s.validateExamplesByMap;n.version(a).arguments("<filepath>").description("Validate embedded examples in Swagger-JSONs.\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","JSON-path to schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --map-filepath <map-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value. If wildcards are used, the parameter has to be put in quotes.").action(function(e,t){var r=t.schemaJsonpath,a=t.exampleFilepath,n=t.mapFilepath,s=null;n?(console.log("Validating with mapping file"),s=l(e,n)):r&&a?(console.log("Validating single external example"),s=i(e,r,a)):(console.log("Validating examples"),s=o(e));!function(e){t=e.statistics,r=t.responseSchemasWithExamples,a=void 0===r?"-":r,n=t.responseExamplesWithoutSchema,s=void 0===n?"-":n,o=t.responseExamplesTotal,i=void 0===o?"-":o,l=t.matchingFilePathsMapping,c=["Response schemas with examples found: "+a,"Response examples without schema found: "+s,"Total examples found: "+i],null!=l&&c.push("Matching mapping files found: "+l),process.stdout.write(c.join("\n")+"\n"),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));var t,r,a,n,s,o,i,l,c;process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(s)}),n.on("--help",function(){console.log("\n\n  Example for external example-file:\n"),console.log("    $ swagger-examples-validator -s $.paths./.get.responses.200.schema -e example.json swagger.json\n\n")}),n.parse(process.argv)},function(e,t){e.exports={name:"swagger-examples-validator",version:"0.7.0",description:"Validates embedded examples in Swagger-JSONs",main:"dist/index.js",bin:{"swagger-examples-validator":"dist/cli.js"},scripts:{build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test:mocha":'BABEL_DISABLE_CACHE=1 mocha --require "babel-register" --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/swagger-examples-validator.git"},keywords:["swagger","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/swagger-examples-validator/issues"},homepage:"https://github.com/codekie/swagger-examples-validator#readme",devDependencies:{"babel-cli":"^6.26.0","babel-core":"^6.26.0","babel-eslint":"^8.2.1","babel-loader":"^7.1.2","babel-plugin-transform-es2015-classes":"^6.24.1","babel-plugin-transform-es2015-parameters":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-es2015":"^6.24.1","babel-preset-es2015-webpack":"6.4.3","babel-register":"^6.26.0",chai:"^4.1.2",coveralls:"^3.0.0",eslint:"^4.17.0","eslint-loader":"^1.9.0","json-loader":"^0.5.7",mocha:"^5.0.1","mocha-lcov-reporter":"^1.3.0",nyc:"^11.4.1",rimraf:"^2.6.2","standard-version":"^4.3.0","uglifyjs-webpack-plugin":"1.1.8",webpack:"^3.11.0"},dependencies:{ajv:"^6.1.1",commander:"^2.14.1",errno:"0.1.7",glob:"7.1.2","jsonpath-plus":"0.16.0",lodash:"4.17.5"}}},function(e,t){e.exports=require("commander")},function(e,t,r){"use strict";var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,n=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){n=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(n)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var s=r(0),o=r(6),i=r(7),l=r(8),c=r(9),p=r(1).custom.createError,u=r(10),m=u.ERR_TYPE__JSON_PATH_NOT_FOUND,f="schema",d="examples",h="$.."+d+".application/json",g=p(m);function v(e){return function(e,t){var r=S(),a=function(e){return e.reduce(function(e,t){var r=function(e){var t=l.toPathArray(e).slice(),r=t.lastIndexOf(d);return t.splice(r,t.length-r,f),l.toPathString(t)}(t);return e[r]=t,e},{})}(e),s=Object.keys(a),o=y({schemaPaths:s}),i={valid:!0,statistics:o,errors:[]};return s.forEach(function(e){var s=i.errors,c=a[e],p=w(c,t),u=O(e,t,!0),m=E({validator:r,responseSchema:u,example:p,statistics:o}).map(function(e){return e.examplePath=l.toPointer(l.toPathArray(c)),e});m.length&&(i.valid=!1,s.splice.apply(s,[s.length-1,0].concat(n(m))))}),i}(function(e){return l({json:e,path:h,resultType:"path"})}(e),e)}function x(e,t){var r=y({schemaPaths:e});return b({errors:t(r),statistics:r})}function b(e){var t=e.errors,r=e.statistics,a=void 0===r?{}:r;return{valid:!t.length,statistics:a,errors:t}}function y(e){return{responseSchemasWithExamples:e.schemaPaths.length,responseExamplesTotal:0,responseExamplesWithoutSchema:0}}function w(e,t){return l({json:t,path:e,flatten:!0,wrap:!1,resultType:"value"})}function E(e){var t=e.validator,r=e.responseSchema,a=e.example,s=e.statistics,o=[];return s.responseExamplesTotal++,r?t.validate(r,a)?o:o.concat.apply(o,n(t.errors.map(u.create))):(s.responseSchemasWithExamples--,s.responseExamplesWithoutSchema++,o)}function S(){return new c({allErrors:!0})}function O(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=w(e,t);if(!r&&!a)throw new g("Path to response-schema can't be found: '"+e+"'",{params:{path:e}});return a}e.exports={default:v,validateFile:function(e){var t=null;try{t=JSON.parse(o.readFileSync(e,"utf-8"))}catch(e){return b({errors:[u.create(e)]})}return v(t)},validateExample:function(e,t,r){var a=null,n=null,s=null;try{a=JSON.parse(o.readFileSync(r,"utf-8")),s=JSON.parse(o.readFileSync(e,"utf-8")),n=O(t,s)}catch(e){return b({errors:[u.create(e)]})}return x([t],function(e){return E({validator:S(),responseSchema:n,example:a,statistics:e}).map(function(e){return e.exampleFilePath=r,e})})},validateExamplesByMap:function(e,t){var r=0,n=i.sync(t,{nonull:!0}).map(function(t){var n=null,i=null;try{n=JSON.parse(o.readFileSync(t,"utf-8")),i=JSON.parse(o.readFileSync(e,"utf-8"))}catch(e){return b({errors:[u.create(e)]})}return r++,x(Object.keys(n),function(e){return function(e,t,r){return s(t).entries().flatMap(function(t){var n=a(t,2),i=n[0],l=n[1],c=null;try{c=O(i,e)}catch(e){return u.create(e)}return s([l]).flatten().flatMap(function(e){var t=null;try{t=JSON.parse(o.readFileSync(e,"utf-8"))}catch(e){return u.create(e)}return E({validator:S(),responseSchema:c,example:t,statistics:r}).map(function(t){return t.exampleFilePath=e,t})}).value()}).value()}(i,n,e).map(function(e){return Object.assign(e,{mapFilePath:t})})})});return s.merge(n.reduce(function(e,t){return e?(n=t,b({errors:(r=e).errors.concat(n.errors),statistics:s.entries(r.statistics).reduce(function(e,t){var r=a(t,2),s=r[0],o=r[1];return e[s]=o+n.statistics[s],e},{})})):t;var r,n},null),{statistics:{matchingFilePathsMapping:r}})}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("ajv")},function(e,t,r){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};var n=r(0),s=r(1).code.ENOENT,o=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,a({type:t},r))}return e.create=function(t){var r=e.ERR_TYPE__VALIDATION,a=t.code,s=t.message,o=t.path,i=t.cause,l=a||t.type||r,c={message:s};return r===l?n.merge(c,t):(o&&n.merge(c,{params:{path:o}}),i&&n.merge(c,i)),new e(l,c)},e}();e.exports=o,o.ERR_TYPE__VALIDATION="Validation",o.ERR_TYPE__JSON_PATH_NOT_FOUND="JsonPathNotFound",o.ERR_TYPE__JS_ENOENT=s.code}]);
//# sourceMappingURL=cli.js.map