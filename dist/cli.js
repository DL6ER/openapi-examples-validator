#!/usr/bin/env node
module.exports=function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=9)}([function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("lodash.merge")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("json-schema-ref-parser")},function(e,t){e.exports=require("errno")},function(e,t){e.exports={parent:"parent",parentProperty:"parentProperty",path:"path",pointer:"pointer",value:"value"}},function(e,t,a){const{JSONPath:n}=a(0),r=a(5),o=["$..application/json.schema",'$..schema..[?(@.properties && (@property === "schema" || @property === "items" || @.type === "object"))]'];function s(e){e.additionalProperties=!1}function i(e,t,a=r.path,o){return n({json:e,path:t,flatten:!0,resultType:a,callback:o})}e.exports={setNoAdditionalProperties:function(e,t=[],a=s){const n=new Set;o.forEach(t=>{i(e,t).forEach(e=>n.add(e))}),function(e,t,a){a.forEach(a=>{i(e,a).forEach(e=>{for(const a of t)a.startsWith(e)&&t.delete(a)})})}(e,n,t);for(const t of n)i(e,t,r.value,a)}}},function(e,t){e.exports=require("lodash.clonedeep")},function(e,t,a){const n=a(1),{ENOENT:r}=a(4).code,o={jsENOENT:r.code,jsonPathNotFound:"JsonPathNotFound",errorAndErrorsMutuallyExclusive:"ErrorErrorsMutuallyExclusive",parseError:"ParseError",validation:"Validation"};class s{static create(e){const{code:t,message:a,path:r,cause:i}=e,l=t||e.type||o.validation,p={message:a};return o.validation===l||o.errorAndErrorsMutuallyExclusive===l?n(p,e):(r&&n(p,{params:{path:r}}),i&&n(p,i)),new s(l,p)}constructor(e,t={}){Object.assign(this,{type:e,...t})}}e.exports={ApplicationError:s,ErrorType:o}},function(e,t,a){const n=a(10).version,r=a(11),{validateFile:o,validateExample:s,validateExamplesByMap:i}=a(12);r.version(n).arguments("<filepath>").description("Validate embedded examples in OpenAPI-specs (JSON and YAML supported).\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","Path to OpenAPI-schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --mapping-filepath <mapping-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value. If wildcards are used, the parameter has to be put in quotes.").option("-c, --cwd-to-mapping-file","changes to the directory of the mapping-file, before resolving the example's paths. Use this option, if your mapping-files use relative paths for the examples").option("-n, --no-additional-properties","don't allow properties that are not described in the schema").action((async function(e,t){const{schemaJsonpath:a,exampleFilepath:n,mappingFilepath:r,cwdToMappingFile:l}=t,p=!t.additionalProperties;let c;r?(console.log("Validating with mapping file"),c=await i(e,r,{cwdToMappingFile:l,noAdditionalProperties:p})):a&&n?(console.log("Validating single external example"),c=await s(e,a,n,{noAdditionalProperties:p})):(console.log("Validating examples"),c=await o(e,{noAdditionalProperties:p}));!function(e){(function(e){const{schemasWithExamples:t,examplesWithoutSchema:a,examplesTotal:n,matchingFilePathsMapping:r}=e,o=["Schemas with examples found: "+t,"Examples without schema found: "+a,"Total examples found: "+n];null!=r&&o.push("Matching mapping files found: "+r);process.stdout.write(o.join("\n")+"\n")})(e.statistics),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(c)})),r.on("--help",()=>{console.log("\n\n  Example for external example-file:\n"),console.log("    $ openapi-examples-validator -s $.paths./.get.responses.200.schema -e example.json openapi-spec.json\n\n")}),r.parse(process.argv)},function(e,t){e.exports={name:"openapi-examples-validator",version:"4.0.0",description:"Validates embedded examples in OpenAPI-JSONs",main:"dist/index.js",engines:{node:">=8"},bin:{"openapi-examples-validator":"dist/cli.js"},scripts:{"start-dev":"babel-node src/cli",build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --mode production --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test-mutations":"stryker run","test:mocha":'mocha --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/openapi-examples-validator.git"},keywords:["swagger","openapi","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/openapi-examples-validator/issues"},homepage:"https://github.com/codekie/openapi-examples-validator#readme",devDependencies:{"@babel/cli":"^7.10.4","@babel/core":"^7.10.4","@babel/node":"^7.10.4","@babel/preset-env":"^7.10.4","@babel/register":"^7.10.4","@stryker-mutator/babel-transpiler":"^3.3.1","@stryker-mutator/core":"^3.3.1","@stryker-mutator/javascript-mutator":"^3.3.1","@stryker-mutator/mocha-framework":"^3.3.1","@stryker-mutator/mocha-runner":"^3.3.1","@stryker-mutator/webpack-transpiler":"^3.3.1","babel-eslint":"^10.1.0","babel-loader":"^8.1.0",chai:"^4.2.0",coveralls:"^3.1.0",eslint:"^7.4.0","eslint-loader":"^4.0.2","json-loader":"^0.5.7",mocha:"^7.1.2","mocha-lcov-reporter":"^1.3.0",nyc:"^15.1.0",rimraf:"^3.0.2","standard-version":"^8.0.2","stryker-cli":"1.0.0",webpack:"^4.43.0","webpack-cli":"^3.3.12"},dependencies:{ajv:"^6.12.5","ajv-oai":"1.2.0",commander:"^5.1.0",errno:"0.1.7",glob:"^7.1.6","json-pointer":"0.6.0","json-schema-ref-parser":"^9.0.6","jsonpath-plus":"^4.0.0","lodash.clonedeep":"^4.5.0","lodash.flatmap":"^4.5.0","lodash.flatten":"^4.4.0","lodash.merge":"^4.6.2",yaml:"^1.10.0"}}},function(e,t){e.exports=require("commander")},function(e,t,a){const n=a(1),r=a(13),o=a(14),s=a(15),i=a(2),l=a(16),p=a(17),{JSONPath:c}=a(0),u=a(3),{createError:d}=a(4).custom,m=a(5),{getValidatorFactory:h,compileValidate:f}=a(18),x=a(24),{ApplicationError:g,ErrorType:y}=a(8),{createValidationResponse:b,dereferenceJsonSchema:v}=a(27),w=Symbol("internal"),E=["yaml","yml"],P=d(y.jsonPathNotFound);async function j(e,{noAdditionalProperties:t}={}){const a=x.getImplementation(e);e=await u.dereference(e),e=a.prepare(e,{noAdditionalProperties:t});let n=a.getJsonPathsToExamples().reduce((t,a)=>t.concat(function(e,t){return c({json:e,path:t,resultType:m.path})}(e,a)),[]);return function({impl:e},t,a){const n=A(),r={valid:!0,statistics:n,errors:[]},o=k(a);let s;try{s=e.buildValidationMap(t)}catch(e){if(!(e instanceof g))throw e;return r.valid=!1,r.errors.push(e),r}return Object.keys(s).forEach(e=>{!function({openapiSpec:e,createValidator:t,pathSchema:a,validationMap:n,statistics:r,validationResult:o}){const s=o.errors;n[a].forEach(n=>{const i=F(n,e),l=q(a,e,!0),p=M({createValidator:t,schema:l,example:i,statistics:r}).map(e=>(e.examplePath=c.toPointer(c.toPathArray(n)),e));p.length&&(o.valid=!1,s.splice(s.length-1,0,...p))})}({openapiSpec:a,createValidator:o,pathSchema:e,validationMap:s,statistics:n,validationResult:r})}),r}({impl:a},n,e)}async function O(e){let t;if(function(e){const t=e.split(".").pop();return E.includes(t)}(e))try{t=p.parse(s.readFileSync(e,"utf-8"))}catch(e){const{name:t,message:a}=e;throw new g(y.parseError,{message:`${t}: ${a}`})}else t=JSON.parse(s.readFileSync(e,"utf-8"));return await v(e,t)}function T(e){const t=A(),a=e(t);return b({errors:a,statistics:t})}function S(e,t,a,{cwdToMappingFile:n=!1,dirPathMapExternalExamples:l}){return o(Object.entries(t),([t,p])=>{let c=null;try{c=q(t,e)}catch(e){return g.create(e)}return o(r([p]),t=>{let r=null;try{const e=n?i.join(l,t):t;r=JSON.parse(s.readFileSync(e,"utf-8"))}catch(e){return[g.create(e)]}return M({createValidator:k(e),schema:c,example:r,statistics:a,filePathExample:t})})})}function A(){const e={[w]:{schemasWithExamples:new Set},examplesTotal:0,examplesWithoutSchema:0};return Object.defineProperty(e,"schemasWithExamples",{enumerable:!0,get:()=>e[w].schemasWithExamples.size}),e}function F(e,t){return c({json:t,path:e,flatten:!0,wrap:!1,resultType:m.value})}function M({createValidator:e,schema:t,example:a,statistics:n,filePathExample:r}){const o=[];if(n.examplesTotal++,!t)return n.examplesWithoutSchema++,o;n[w].schemasWithExamples.add(t);const s=f(e(),t);return s(a)?o:o.concat(...s.errors.map(g.create)).map(e=>r?(e.exampleFilePath=r,e):e)}function k(e){return h(e,{allErrors:!0,nullable:!0})}function q(e,t,a=!1){const n=F(e,t);if(!a&&!n)throw new P(`Path to schema can't be found: '${e}'`,{params:{path:e}});return n}e.exports={default:j,validateFile:async function(e,{noAdditionalProperties:t}={}){let a=null;try{a=await O(e)}catch(e){return b({errors:[g.create(e)]})}return j(a,{noAdditionalProperties:t})},validateExample:async function(e,t,a,{noAdditionalProperties:n}={}){let r=null,o=null,i=null;try{r=JSON.parse(s.readFileSync(a,"utf-8")),i=await O(e),i=x.getImplementation(i).prepare(i,{noAdditionalProperties:n}),o=q(t,i)}catch(e){return b({errors:[g.create(e)]})}return T(e=>M({createValidator:k(i),schema:o,example:r,statistics:e,filePathExample:a}))},validateExamplesByMap:async function(e,t,{cwdToMappingFile:a,noAdditionalProperties:r}={}){let o=0;const p=l.sync(t,{nonull:!0});let c=[];for(let t of p){let n=null,l=null;try{n=JSON.parse(s.readFileSync(t,"utf-8")),l=await O(e),l=x.getImplementation(l).prepare(l,{noAdditionalProperties:r})}catch(e){c.push(b({errors:[g.create(e)]}));continue}o++,c.push(T(e=>S(l,n,e,{cwdToMappingFile:a,dirPathMapExternalExamples:i.dirname(t)}).map(e=>Object.assign(e,{mapFilePath:t}))))}return n(c.reduce((e,t)=>{return e?(n=t,b({errors:(a=e).errors.concat(n.errors),statistics:Object.entries(a.statistics).reduce((e,[t,r])=>"schemasWithExamples"===t?([a,n].forEach(t=>{const a=t.statistics[w].schemasWithExamples.values();for(let t of a)e[w].schemasWithExamples.add(t)}),e):(e[t]=r+n.statistics[t],e),A())})):t;var a,n},null),{statistics:{matchingFilePathsMapping:o}})}}},function(e,t){e.exports=require("lodash.flatten")},function(e,t){e.exports=require("lodash.flatmap")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("yaml")},function(e,t,a){const{JSONPath:n}=a(0),r=a(19),o=a(20),s=a(21),i="https://www.npmjs.com/package/openapi-examples-validator/defs.json";function l(e){n({path:"$..$ref",json:e,callback(e,t,a){e.startsWith("#")&&(a.parent[a.parentProperty]=`${i}${e}`)}})}e.exports={getValidatorFactory:function(e,t){const a=function(e){const t={$id:i};return n({path:"$..$ref",json:e,callback(a){if(!a.startsWith("#"))return;const n=a.substring(1),o=r.get(e,n);r.set(t,n,o)}}),t}(e);return()=>{const e=new o(t);return e.addSchema(a),function(e){e.addFormat("int32",{type:"number",validate:s.int32}),e.addFormat("int64",{type:"string",validate:s.int64}),e.addFormat("float",{type:"number",validate:s.float}),e.addFormat("double",{type:"number",validate:s.double}),e.addFormat("byte",{type:"string",validate:s.byte})}(e),e}},compileValidate:function(e,t){const a=function(e,t){const a=Object.assign({},e);return a.$id=t,a}(t,"https://www.npmjs.com/package/openapi-examples-validator/schema.json");return l(a),e.compile(a)}}},function(e,t){e.exports=require("json-pointer")},function(e,t){e.exports=require("ajv")},function(e,t,a){const n=a(22);e.exports={int32:function(e){return Number.isInteger(+e)&&n.int32.max.greaterThanOrEqualTo(e)&&n.int32.min.lessThanOrEqualTo(e)},int64:function(e){return Number.isInteger(+e)&&n.int64.max.greaterThanOrEqualTo(e)&&n.int64.min.lessThanOrEqualTo(e)},float:function(e){return n.float.max.greaterThanOrEqualTo(e)&&n.float.min.lessThanOrEqualTo(e)},double:function(e){return n.double.max.greaterThanOrEqualTo(e)&&n.double.min.lessThanOrEqualTo(e)},byte:function(e){const t=e.length;if(!t||t%4!=0||/[^A-Z0-9+\/=]/i.test(e))return!1;const a=e.indexOf("=");return-1===a||a===t-1||a===t-2&&"="===e[t-1]}}},function(e,t,a){const n=a(23),r={byte:{min:new n("-128"),max:new n("127")},int32:{min:new n("-2147483648"),max:new n("2147483647")},int64:{min:new n("-9223372036854775808"),max:new n("9223372036854775807")},float:{min:new n(2).pow(128).negated(),max:new n(2).pow(128)},double:{min:new n(2).pow(1024).negated(),max:new n(2).pow(1024)}};e.exports=r},function(e,t){e.exports=require("decimal.js")},function(e,t,a){const n=a(25),r=a(26),o=/^3\./;e.exports={getImplementation:function(e){if("string"==typeof e.swagger)return n;if(e.openapi&&e.openapi.match(o))return r;return null}}},function(e,t,a){const{JSONPath:n}=a(0),{setNoAdditionalProperties:r}=a(6),o=a(7);function s(){return["$..examples.application/json"]}e.exports={buildValidationMap:function(e){return e.reduce((e,t)=>{const a=function(e){const t=n.toPathArray(e).slice(),a=t.lastIndexOf("examples");return t.splice(a,t.length-a,"schema"),n.toPathString(t)}(t);return e[a]=(e[a]||new Set).add(t),e},{})},getJsonPathsToExamples:s,prepare:function(e,{noAdditionalProperties:t}={}){const a=o(e);return t&&r(a,s()),a}}},function(e,t,a){const{JSONPath:n}=a(0),r=a(7),{ApplicationError:o,ErrorType:s}=a(8),{setNoAdditionalProperties:i}=a(6),l="single",p="multi";function c(){return["$..responses..content.application/json.example","$..responses..content.application/json.examples.*.value","$..parameters..example","$..parameters..examples.*.value","$..requestBody.content.application/json.example","$..requestBody.content.application/json.examples.*.value"]}e.exports={buildValidationMap:function(e){const t=new Map;return e.reduce((e,a)=>{const{pathSchemaAsArray:r,exampleType:i}=function(e){const t=n.toPathArray(e).slice(),a=t.lastIndexOf("example"),r=a>-1?l:p,o=r===l?a:t.lastIndexOf("examples");return t.splice(o,t.length-o,"schema"),{exampleType:r,pathSchemaAsArray:t}}(a),c=n.toPathString(r),u=t.get(c);return u&&u!==i&&function(e){const t=e.slice(0,e.length-1);throw o.create({type:s.errorAndErrorsMutuallyExclusive,message:'Properties "error" and "errors" are mutually exclusive',params:{pathContext:n.toPointer(t)}})}(r),t.set(c,i),e[c]=(e[c]||new Set).add(a),e},{})},getJsonPathsToExamples:c,prepare:function(e,{noAdditionalProperties:t}={}){const a=r(e);return t&&i(a,c()),a}}},function(e,t,a){const n=a(2),r=a(3);e.exports={createValidationResponse:function({errors:e,statistics:t={}}){return{valid:!e.length,statistics:t,errors:e}},dereferenceJsonSchema:async function(e,t){const a=process.cwd();process.chdir(n.dirname(e));const o=await r.dereference(t);return process.chdir(a),o}}}]);
//# sourceMappingURL=cli.js.map