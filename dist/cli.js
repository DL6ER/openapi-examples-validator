#!/usr/bin/env node
module.exports=function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("errno")},function(e,t,a){function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const o=a(1),i={jsENOENT:a(2).code.ENOENT.code,jsonPathNotFound:"JsonPathNotFound",errorAndErrorsMutuallyExclusive:"ErrorErrorsMutuallyExclusive",validation:"Validation"};class s{static create(e){const t=e.code,a=e.message,r=e.path,n=e.cause,l=t||e.type||i.validation,p={message:a};return i.validation===l||i.errorAndErrorsMutuallyExclusive===l?o.merge(p,e):(r&&o.merge(p,{params:{path:r}}),n&&o.merge(p,n)),new s(l,p)}constructor(e,t={}){Object.assign(this,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({type:e},t))}}e.exports={ApplicationError:s,ErrorType:i}},function(e,t,a){const r=a(5).version,n=a(6),o=a(7),i=o.validateFile,s=o.validateExample,l=o.validateExamplesByMap;n.version(r).arguments("<filepath>").description("Validate embedded examples in OpenAPI-specs (JSON and YAML supported).\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","Path to OpenAPI-schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --mapping-filepath <mapping-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value. If wildcards are used, the parameter has to be put in quotes.").option("-c, --cwd-to-mapping-file","changes to the directory of the mapping-file, before resolving the example's paths. Use this option, if your mapping-files use relative paths for the examples").action((function(e,t){const a=t.schemaJsonpath,r=t.exampleFilepath,n=t.mappingFilepath,o=t.cwdToMappingFile;let p;n?(console.log("Validating with mapping file"),p=l(e,n,{cwdToMappingFile:o})):a&&r?(console.log("Validating single external example"),p=s(e,a,r)):(console.log("Validating examples"),p=i(e));!function(e){(function(e){const t=e.schemasWithExamples,a=e.examplesWithoutSchema,r=e.examplesTotal,n=e.matchingFilePathsMapping,o=[`Schemas with examples found: ${t}`,`Examples without schema found: ${a}`,`Total examples found: ${r}`];null!=n&&o.push(`Matching mapping files found: ${n}`);process.stdout.write(`${o.join("\n")}\n`)})(e.statistics),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(p)})),n.on("--help",()=>{console.log("\n\n  Example for external example-file:\n"),console.log("    $ openapi-examples-validator -s $.paths./.get.responses.200.schema -e example.json openapi-spec.json\n\n")}),n.parse(process.argv)},function(e,t){e.exports={name:"openapi-examples-validator",version:"2.0.1",description:"Validates embedded examples in OpenAPI-JSONs",main:"dist/index.js",engines:{node:">=8"},bin:{"openapi-examples-validator":"dist/cli.js"},scripts:{"start-dev":"babel-node src/cli",build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --mode production --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test-mutations":"stryker run","test:mocha":'BABEL_DISABLE_CACHE=1 mocha --require "@babel/register" --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/openapi-examples-validator.git"},keywords:["swagger","openapi","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/openapi-examples-validator/issues"},homepage:"https://github.com/codekie/openapi-examples-validator#readme",devDependencies:{"@babel/cli":"^7.8.4","@babel/core":"^7.8.4","@babel/node":"^7.8.4","@babel/preset-env":"^7.8.4","@babel/register":"^7.8.3","@stryker-mutator/babel-transpiler":"^2.5.0","@stryker-mutator/core":"^2.5.0","@stryker-mutator/html-reporter":"^2.5.0","@stryker-mutator/javascript-mutator":"^2.5.0","@stryker-mutator/mocha-framework":"^2.5.0","@stryker-mutator/mocha-runner":"^2.5.0","@stryker-mutator/webpack-transpiler":"^2.5.0","babel-eslint":"^10.0.3","babel-loader":"^8.0.6",chai:"^4.2.0",coveralls:"^3.0.9",eslint:"^6.8.0","eslint-loader":"^3.0.3","json-loader":"^0.5.7",mocha:"^7.0.1","mocha-lcov-reporter":"^1.3.0",nyc:"^15.0.0",rimraf:"^3.0.2","standard-version":"^7.1.0","stryker-cli":"1.0.0",webpack:"^4.41.6","webpack-cli":"^3.3.11"},dependencies:{ajv:"^6.12.0","ajv-oai":"1.2.0",commander:"^4.1.1",errno:"0.1.7",glob:"^7.1.6","json-pointer":"0.6.0","jsonpath-plus":"^3.0.0",lodash:"^4.17.15",yaml:"1.7.2"}}},function(e,t){e.exports=require("commander")},function(e,t,a){const r=a(1),n=a(8),o=a(9),i=a(10),s=a(11),l=a(0).JSONPath,p=a(2).custom.createError,c=a(12),u=a(13),m=u.getValidatorFactory,d=u.compileValidate,f=a(19),h=a(3),x=h.ApplicationError,g=h.ErrorType,b=a(22).createValidationResponse,y=["yaml","yml"],v=p(g.jsonPathNotFound);function w(e){const t=f.getImplementation(e);e=t.prepare(e);let a=t.getJsonPathsToExamples().reduce((t,a)=>t.concat(function(e,t){return l({json:e,path:t,resultType:c.path})}(e,a)),[]);return function({impl:e},t,a){const r=E(),n={valid:!0,statistics:r,errors:[]},o=S(a);let i;try{i=e.buildValidationMap(t)}catch(e){if(!(e instanceof x))throw e;return n.valid=!1,n.errors.push(e),n}const s=Object.keys(i);return n.statistics.schemasWithExamples=s.length,s.forEach(e=>{!function({openapiSpec:e,createValidator:t,pathSchema:a,validationMap:r,statistics:n,validationResult:o}){const i=o.errors;r[a].forEach(r=>{const s=P(r,e),p=M(a,e,!0),c=T({createValidator:t,schema:p,example:s,statistics:n}).map(e=>(e.examplePath=l.toPointer(l.toPathArray(r)),e));c.length&&(o.valid=!1,i.splice(i.length-1,0,...c))})}({openapiSpec:a,createValidator:o,pathSchema:e,validationMap:i,statistics:r,validationResult:n})}),n}({impl:t},a,e)}function j(e){return function(e){const t=e.split(".").pop();return y.includes(t)}(e)?s.parse(n.readFileSync(e,"utf-8")):JSON.parse(n.readFileSync(e,"utf-8"))}function O(e,t){const a=E({schemaPaths:e}),r=t(a);return b({errors:r,statistics:a})}function E({schemaPaths:e=[]}={}){return{schemasWithExamples:e.length,examplesTotal:0,examplesWithoutSchema:0}}function P(e,t){return l({json:t,path:e,flatten:!0,wrap:!1,resultType:c.value})}function T({createValidator:e,schema:t,example:a,statistics:r,filePathExample:n}){const o=[];if(r.examplesTotal++,!t)return r.schemasWithExamples--,r.examplesWithoutSchema++,o;const i=d(e(),t);return i(a)?o:o.concat(...i.errors.map(x.create)).map(e=>n?(e.exampleFilePath=n,e):e)}function S(e){return m(e,{allErrors:!0,nullable:!0})}function M(e,t,a=!1){const r=P(e,t);if(!a&&!r)throw new v(`Path to schema can't be found: '${e}'`,{params:{path:e}});return r}e.exports={default:w,validateFile:function(e){let t=null;try{t=j(e)}catch(e){return b({errors:[x.create(e)]})}return w(t)},validateExample:function(e,t,a){let r=null,o=null,i=null;try{r=JSON.parse(n.readFileSync(a,"utf-8")),i=j(e),i=f.getImplementation(i).prepare(i),o=M(t,i)}catch(e){return b({errors:[x.create(e)]})}return O([t],e=>T({createValidator:S(i),schema:o,example:r,statistics:e,filePathExample:a}))},validateExamplesByMap:function(e,t,{cwdToMappingFile:a}={}){let s=0;const l=i.sync(t,{nonull:!0}).map(t=>{let i=null,l=null;try{i=JSON.parse(n.readFileSync(t,"utf-8")),l=j(e),l=f.getImplementation(l).prepare(l)}catch(e){return b({errors:[x.create(e)]})}return s++,O(Object.keys(i),e=>function(e,t,a,{cwdToMappingFile:i=!1,dirPathMapExternalExamples:s}){return r(t).entries().flatMap(([t,l])=>{let p=null;try{p=M(t,e)}catch(e){return x.create(e)}return r([l]).flatten().flatMap(t=>{let r=null;try{const e=i?o.join(s,t):t;r=JSON.parse(n.readFileSync(e,"utf-8"))}catch(e){return x.create(e)}return T({createValidator:S(e),schema:p,example:r,statistics:a,filePathExample:t})}).value()}).value()}(l,i,e,{cwdToMappingFile:a,dirPathMapExternalExamples:o.dirname(t)}).map(e=>Object.assign(e,{mapFilePath:t})))});return r.merge(l.reduce((e,t)=>{return e?(n=t,b({errors:(a=e).errors.concat(n.errors),statistics:r.entries(a.statistics).reduce((e,[t,a])=>(e[t]=a+n.statistics[t],e),E())})):t;var a,n},null),{statistics:{matchingFilePathsMapping:s}})}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("yaml")},function(e,t){e.exports={parent:"parent",parentProperty:"parentProperty",path:"path",pointer:"pointer",value:"value"}},function(e,t,a){const r=a(0).JSONPath,n=a(14),o=a(15),i=a(16),s="https://www.npmjs.com/package/openapi-examples-validator/defs.json";function l(e){r({path:"$..$ref",json:e,callback(e,t,a){e.startsWith("#")&&(a.parent[a.parentProperty]=`${s}${e}`)}})}e.exports={getValidatorFactory:function(e,t){const a=function(e){const t={$id:s};return r({path:"$..$ref",json:e,callback(a){if(!a.startsWith("#"))return;const r=a.substring(1),o=n.get(e,r);n.set(t,r,o)}}),t}(e);return()=>{const e=new o(t);return e.addSchema(a),function(e){e.addFormat("int32",{type:"number",validate:i.int32}),e.addFormat("int64",{type:"string",validate:i.int64}),e.addFormat("float",{type:"number",validate:i.float}),e.addFormat("double",{type:"number",validate:i.double}),e.addFormat("byte",{type:"string",validate:i.byte})}(e),e}},compileValidate:function(e,t){const a=function(e,t){const a=Object.assign({},e);return a.$id=t,a}(t,"https://www.npmjs.com/package/openapi-examples-validator/schema.json");return l(a),e.compile(a)}}},function(e,t){e.exports=require("json-pointer")},function(e,t){e.exports=require("ajv")},function(e,t,a){const r=a(17);e.exports={int32:function(e){return Number.isInteger(+e)&&r.int32.max.greaterThanOrEqualTo(e)&&r.int32.min.lessThanOrEqualTo(e)},int64:function(e){return Number.isInteger(+e)&&r.int64.max.greaterThanOrEqualTo(e)&&r.int64.min.lessThanOrEqualTo(e)},float:function(e){return r.float.max.greaterThanOrEqualTo(e)&&r.float.min.lessThanOrEqualTo(e)},double:function(e){return r.double.max.greaterThanOrEqualTo(e)&&r.double.min.lessThanOrEqualTo(e)},byte:function(e){const t=e.length;if(!t||t%4!=0||/[^A-Z0-9+\/=]/i.test(e))return!1;const a=e.indexOf("=");return-1===a||a===t-1||a===t-2&&"="===e[t-1]}}},function(e,t,a){const r=a(18),n={byte:{min:new r("-128"),max:new r("127")},int32:{min:new r("-2147483648"),max:new r("2147483647")},int64:{min:new r("-9223372036854775808"),max:new r("9223372036854775807")},float:{min:new r(2).pow(128).negated(),max:new r(2).pow(128)},double:{min:new r(2).pow(1024).negated(),max:new r(2).pow(1024)}};e.exports=n},function(e,t){e.exports=require("decimal.js")},function(e,t,a){const r=a(20),n=a(21),o=/^3\./;e.exports={getImplementation:function(e){if("string"==typeof e.swagger)return r;if(e.openapi&&e.openapi.match(o))return n;return null}}},function(e,t,a){const r=a(0).JSONPath;e.exports={buildValidationMap:function(e){return e.reduce((e,t)=>{const a=function(e){const t=r.toPathArray(e).slice(),a=t.lastIndexOf("examples");return t.splice(a,t.length-a,"schema"),r.toPathString(t)}(t);return e[a]=(e[a]||new Set).add(t),e},{})},getJsonPathsToExamples:function(){return["$..examples.application/json"]},prepare:function(e){return e}}},function(e,t,a){const r=a(0).JSONPath,n=a(3),o=n.ApplicationError,i=n.ErrorType,s="single",l="multi";e.exports={buildValidationMap:function(e){const t=new Map;return e.reduce((e,a)=>{const n=function(e){const t=r.toPathArray(e).slice(),a=t.lastIndexOf("example"),n=a>-1?s:l,o=n===s?a:t.lastIndexOf("examples");return t.splice(o,t.length-o,"schema"),{exampleType:n,pathSchemaAsArray:t}}(a),p=n.pathSchemaAsArray,c=n.exampleType,u=r.toPathString(p),m=t.get(u);return m&&m!==c&&function(e){const t=e.slice(0,e.length-1);throw o.create({type:i.errorAndErrorsMutuallyExclusive,message:'Properties "error" and "errors" are mutually exclusive',params:{pathContext:r.toPointer(t)}})}(p),t.set(u,c),e[u]=(e[u]||new Set).add(a),e},{})},getJsonPathsToExamples:function(){return["$..responses..content.application/json.example","$..responses..content.application/json.examples..value","$..parameters..example","$..parameters..examples..value","$..requestBody.content.application/json.example","$..requestBody.content.application/json.examples..value"]},prepare:function(e){return e}}},function(e,t){e.exports={createValidationResponse:function({errors:e,statistics:t={}}){return{valid:!e.length,statistics:t,errors:e}}}}]);
//# sourceMappingURL=cli.js.map