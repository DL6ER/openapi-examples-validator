#!/usr/bin/env node
module.exports=function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("errno")},function(e,t,a){const r=a(3).version,n=a(4),s=a(5),o=s.validateFile,i=s.validateExample,l=s.validateExamplesByMap;n.version(r).arguments("<filepath>").description("Validate embedded examples in Swagger-JSONs.\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","JSON-path to schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --mapping-filepath <mapping-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value. If wildcards are used, the parameter has to be put in quotes.").option("-c, --cwd-to-mapping-file","changes to the directory of the mapping-file, before resolving the example's paths. Use this option, if your mapping-files use relative paths for the examples").action(function(e,t){const a=t.schemaJsonpath,r=t.exampleFilepath,n=t.mappingFilepath,s=t.cwdToMappingFile;let c=null;n?(console.log("Validating with mapping file"),c=l(e,n,{cwdToMappingFile:s})):a&&r?(console.log("Validating single external example"),c=i(e,a,r)):(console.log("Validating examples"),c=o(e));!function(e){(function(e){const t=e.responseSchemasWithExamples,a=void 0===t?"-":t,r=e.responseExamplesWithoutSchema,n=void 0===r?"-":r,s=e.responseExamplesTotal,o=void 0===s?"-":s,i=e.matchingFilePathsMapping,l=[`Response schemas with examples found: ${a}`,`Response examples without schema found: ${n}`,`Total examples found: ${o}`];null!=i&&l.push(`Matching mapping files found: ${i}`),process.stdout.write(`${l.join("\n")}\n`)})(e.statistics),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(c)}),n.on("--help",()=>{console.log("\n\n  Example for external example-file:\n"),console.log("    $ swagger-examples-validator -s $.paths./.get.responses.200.schema -e example.json swagger.json\n\n")}),n.parse(process.argv)},function(e,t){e.exports={name:"swagger-examples-validator",version:"0.9.2",description:"Validates embedded examples in Swagger-JSONs",main:"dist/index.js",engines:{node:">=6"},bin:{"swagger-examples-validator":"dist/cli.js"},scripts:{"start-dev":"babel-node src/cli",build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --mode production --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test:mocha":'BABEL_DISABLE_CACHE=1 mocha --require "@babel/register" --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/swagger-examples-validator.git"},keywords:["swagger","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/swagger-examples-validator/issues"},homepage:"https://github.com/codekie/swagger-examples-validator#readme",devDependencies:{"@babel/cli":"^7.1.2","@babel/core":"^7.1.2","@babel/node":"^7.0.0","@babel/preset-env":"^7.1.0","@babel/register":"^7.0.0","babel-eslint":"^10.0.1","babel-loader":"^8.0.4",chai:"^4.2.0",coveralls:"^3.0.2",eslint:"^5.6.1","eslint-loader":"^2.1.1","json-loader":"^0.5.7",mocha:"^5.2.0","mocha-lcov-reporter":"^1.3.0",nyc:"^13.0.1",rimraf:"^2.6.2","standard-version":"^4.4.0","uglifyjs-webpack-plugin":"^2.0.1",webpack:"^4.20.2","webpack-cli":"^3.1.2"},dependencies:{ajv:"^6.5.4",commander:"^2.19.0",errno:"0.1.7",glob:"^7.1.3","jsonpath-plus":"0.16.0",lodash:"^4.17.11"}}},function(e,t){e.exports=require("commander")},function(e,t,a){const r=a(0),n=a(6),s=a(7),o=a(8),i=a(9),l=a(10),c=a(1).custom.createError,p=a(11),u=p.ERR_TYPE__JSON_PATH_NOT_FOUND,m="schema",d="examples",h=`$..${d}.application/json`,f=c(u);function g(e){return function(e,t){const a=E(),r=function(e){return e.reduce((e,t)=>{const a=function(e){const t=i.toPathArray(e).slice(),a=t.lastIndexOf(d);return t.splice(a,t.length-a,m),i.toPathString(t)}(t);return e[a]=t,e},{})}(e),n=Object.keys(r),s=v({schemaPaths:n}),o={valid:!0,statistics:s,errors:[]};return n.forEach(e=>{const n=o.errors,l=r[e],c=y(l,t),p=O(e,t,!0),u=w({validator:a,responseSchema:p,example:c,statistics:s}).map(e=>(e.examplePath=i.toPointer(i.toPathArray(l)),e));u.length&&(o.valid=!1,n.splice(n.length-1,0,...u))}),o}(function(e){return i({json:e,path:h,resultType:"path"})}(e),e)}function x(e,t){const a=v({schemaPaths:e});return b({errors:t(a),statistics:a})}function b({errors:e,statistics:t={}}){return{valid:!e.length,statistics:t,errors:e}}function v({schemaPaths:e}){return{responseSchemasWithExamples:e.length,responseExamplesTotal:0,responseExamplesWithoutSchema:0}}function y(e,t){return i({json:t,path:e,flatten:!0,wrap:!1,resultType:"value"})}function w({validator:e,responseSchema:t,example:a,statistics:r}){const n=[];return r.responseExamplesTotal++,t?e.validate(t,a)?n:n.concat(...e.errors.map(p.create)):(r.responseSchemasWithExamples--,r.responseExamplesWithoutSchema++,n)}function E(){return new l({allErrors:!0})}function O(e,t,a=!1){const r=y(e,t);if(!a&&!r)throw new f(`Path to response-schema can't be found: '${e}'`,{params:{path:e}});return r}e.exports={default:g,validateFile:function(e){let t=null;try{t=JSON.parse(n.readFileSync(e,"utf-8"))}catch(e){return b({errors:[p.create(e)]})}return g(t)},validateExample:function(e,t,a){let r=null,s=null,o=null;try{r=JSON.parse(n.readFileSync(a,"utf-8")),o=JSON.parse(n.readFileSync(e,"utf-8")),s=O(t,o)}catch(e){return b({errors:[p.create(e)]})}return x([t],e=>w({validator:E(),responseSchema:s,example:r,statistics:e}).map(e=>(e.exampleFilePath=a,e)))},validateExamplesByMap:function(e,t,{cwdToMappingFile:a}={}){let i=0;const l=o.sync(t,{nonull:!0}).map(t=>{let o=null,l=null;try{o=JSON.parse(n.readFileSync(t,"utf-8")),l=JSON.parse(n.readFileSync(e,"utf-8"))}catch(e){return b({errors:[p.create(e)]})}return i++,x(Object.keys(o),e=>(function(e,t,a,{cwdToMappingFile:o=!1,dirPathMapExternalExamples:i}){return r(t).entries().flatMap(([t,l])=>{let c=null;try{c=O(t,e)}catch(e){return p.create(e)}return r([l]).flatten().flatMap(e=>{let t=null;try{const a=o?s.join(i,e):e;t=JSON.parse(n.readFileSync(a,"utf-8"))}catch(e){return p.create(e)}return w({validator:E(),responseSchema:c,example:t,statistics:a}).map(t=>(t.exampleFilePath=e,t))}).value()}).value()})(l,o,e,{cwdToMappingFile:a,dirPathMapExternalExamples:s.dirname(t)}).map(e=>Object.assign(e,{mapFilePath:t})))});return r.merge(l.reduce((e,t)=>e?function(e,t){return b({errors:e.errors.concat(t.errors),statistics:r.entries(e.statistics).reduce((e,[a,r])=>(e[a]=r+t.statistics[a],e),v({schemaPaths:[]}))})}(e,t):t,null),{statistics:{matchingFilePathsMapping:i}})}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("ajv")},function(e,t,a){function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const n=a(0),s=a(1).code.ENOENT;class o{static create(e){const t=o.ERR_TYPE__VALIDATION,a=e.code,r=e.message,s=e.path,i=e.cause,l=a||e.type||t,c={message:r};return t===l?n.merge(c,e):(s&&n.merge(c,{params:{path:s}}),i&&n.merge(c,i)),new o(l,c)}constructor(e,t={}){Object.assign(this,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){r(e,t,a[t])})}return e}({type:e},t))}}e.exports=o,o.ERR_TYPE__VALIDATION="Validation",o.ERR_TYPE__JSON_PATH_NOT_FOUND="JsonPathNotFound",o.ERR_TYPE__JS_ENOENT=s.code}]);
//# sourceMappingURL=cli.js.map