#!/usr/bin/env node
module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("errno")},function(e,t,r){var n=r(3).version,a=r(4),o=r(5),i=o.validateFile,s=o.validateExample,l=o.validateExamplesByMap;a.version(n).arguments("<filepath>").description("Validate embedded examples in Swagger-JSONs.\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","JSON-path to schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --mapping-filepath <mapping-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value. If wildcards are used, the parameter has to be put in quotes.").option("-c, --cwd-to-mapping-file","changes to the directory of the mapping-file, before resolving the example's paths. Use this option, if your mapping-files use relative paths for the examples").action(function(e,t){var r=t.schemaJsonpath,n=t.exampleFilepath,a=t.mappingFilepath,o=t.cwdToMappingFile,c=null;a?(console.log("Validating with mapping file"),c=l(e,a,{cwdToMappingFile:o})):r&&n?(console.log("Validating single external example"),c=s(e,r,n)):(console.log("Validating examples"),c=i(e));!function(e){(function(e){var t=e.responseSchemasWithExamples,r=void 0===t?"-":t,n=e.responseExamplesWithoutSchema,a=void 0===n?"-":n,o=e.responseExamplesTotal,i=void 0===o?"-":o,s=e.matchingFilePathsMapping,l=["Response schemas with examples found: ".concat(r),"Response examples without schema found: ".concat(a),"Total examples found: ".concat(i)];null!=s&&l.push("Matching mapping files found: ".concat(s)),process.stdout.write("".concat(l.join("\n"),"\n"))})(e.statistics),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(c)}),a.on("--help",function(){console.log("\n\n  Example for external example-file:\n"),console.log("    $ swagger-examples-validator -s $.paths./.get.responses.200.schema -e example.json swagger.json\n\n")}),a.parse(process.argv)},function(e,t){e.exports={name:"swagger-examples-validator",version:"0.9.0",description:"Validates embedded examples in Swagger-JSONs",main:"dist/index.js",bin:{"swagger-examples-validator":"dist/cli.js"},scripts:{"start-dev":"babel-node src/cli",build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --mode production --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test:mocha":'BABEL_DISABLE_CACHE=1 mocha --require "@babel/register" --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/swagger-examples-validator.git"},keywords:["swagger","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/swagger-examples-validator/issues"},homepage:"https://github.com/codekie/swagger-examples-validator#readme",devDependencies:{"@babel/cli":"^7.1.2","@babel/core":"^7.1.2","@babel/node":"^7.0.0","@babel/preset-env":"^7.1.0","@babel/register":"^7.0.0","babel-eslint":"^10.0.1","babel-loader":"^8.0.4",chai:"^4.2.0",coveralls:"^3.0.2",eslint:"^5.6.1","eslint-loader":"^2.1.1","json-loader":"^0.5.7",mocha:"^5.2.0","mocha-lcov-reporter":"^1.3.0",nyc:"^13.0.1",rimraf:"^2.6.2","standard-version":"^4.4.0","uglifyjs-webpack-plugin":"^2.0.1",webpack:"^4.20.2","webpack-cli":"^3.1.2"},dependencies:{ajv:"^6.5.4",commander:"^2.19.0",errno:"0.1.7",glob:"^7.1.3","jsonpath-plus":"0.16.0",lodash:"^4.17.11"}}},function(e,t){e.exports=require("commander")},function(e,t,r){function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=r(0),i=r(6),s=r(7),l=r(8),c=r(9),p=r(10),u=r(1).custom.createError,f=r(11),m=f.ERR_TYPE__JSON_PATH_NOT_FOUND,d="schema",h="examples",g="$..".concat(h,".application/json"),v=u(m);function b(e){return function(e,t){var r=S(),a=function(e){return e.reduce(function(e,t){var r=function(e){var t=c.toPathArray(e).slice(),r=t.lastIndexOf(h);return t.splice(r,t.length-r,d),c.toPathString(t)}(t);return e[r]=t,e},{})}(e),o=Object.keys(a),i=w({schemaPaths:o}),s={valid:!0,statistics:i,errors:[]};return o.forEach(function(e){var o=s.errors,l=a[e],p=E(l,t),u=j(e,t,!0),f=O({validator:r,responseSchema:u,example:p,statistics:i}).map(function(e){return e.examplePath=c.toPointer(c.toPathArray(l)),e});f.length&&(s.valid=!1,o.splice.apply(o,[o.length-1,0].concat(n(f))))}),s}(function(e){return c({json:e,path:g,resultType:"path"})}(e),e)}function x(e,t){var r=w({schemaPaths:e});return y({errors:t(r),statistics:r})}function y(e){var t=e.errors,r=e.statistics,n=void 0===r?{}:r;return{valid:!t.length,statistics:n,errors:t}}function w(e){return{responseSchemasWithExamples:e.schemaPaths.length,responseExamplesTotal:0,responseExamplesWithoutSchema:0}}function E(e,t){return c({json:t,path:e,flatten:!0,wrap:!1,resultType:"value"})}function O(e){var t=e.validator,r=e.responseSchema,a=e.example,o=e.statistics,i=[];return o.responseExamplesTotal++,r?t.validate(r,a)?i:i.concat.apply(i,n(t.errors.map(f.create))):(o.responseSchemasWithExamples--,o.responseExamplesWithoutSchema++,i)}function S(){return new p({allErrors:!0})}function j(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=E(e,t);if(!r&&!n)throw new v("Path to response-schema can't be found: '".concat(e,"'"),{params:{path:e}});return n}e.exports={default:b,validateFile:function(e){var t=null;try{t=JSON.parse(i.readFileSync(e,"utf-8"))}catch(e){return y({errors:[f.create(e)]})}return b(t)},validateExample:function(e,t,r){var n=null,a=null,o=null;try{n=JSON.parse(i.readFileSync(r,"utf-8")),o=JSON.parse(i.readFileSync(e,"utf-8")),a=j(t,o)}catch(e){return y({errors:[f.create(e)]})}return x([t],function(e){return O({validator:S(),responseSchema:a,example:n,statistics:e}).map(function(e){return e.exampleFilePath=r,e})})},validateExamplesByMap:function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).cwdToMappingFile,n=0,c=l.sync(t,{nonull:!0}).map(function(t){var l=null,c=null;try{l=JSON.parse(i.readFileSync(t,"utf-8")),c=JSON.parse(i.readFileSync(e,"utf-8"))}catch(e){return y({errors:[f.create(e)]})}return n++,x(Object.keys(l),function(e){return function(e,t,r,n){var l=n.cwdToMappingFile,c=void 0!==l&&l,p=n.dirPathMapExternalExamples;return o(t).entries().flatMap(function(t){var n=a(t,2),l=n[0],u=n[1],m=null;try{m=j(l,e)}catch(e){return f.create(e)}return o([u]).flatten().flatMap(function(e){var t=null;try{var n=c?s.join(p,e):e;t=JSON.parse(i.readFileSync(n,"utf-8"))}catch(e){return f.create(e)}return O({validator:S(),responseSchema:m,example:t,statistics:r}).map(function(t){return t.exampleFilePath=e,t})}).value()}).value()}(c,l,e,{cwdToMappingFile:r,dirPathMapExternalExamples:s.dirname(t)}).map(function(e){return Object.assign(e,{mapFilePath:t})})})});return o.merge(c.reduce(function(e,t){return e?function(e,t){return y({errors:e.errors.concat(t.errors),statistics:o.entries(e.statistics).reduce(function(e,r){var n=a(r,2),o=n[0],i=n[1];return e[o]=i+t.statistics[o],e},w({schemaPaths:[]}))})}(e,t):t},null),{statistics:{matchingFilePathsMapping:n}})}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("ajv")},function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=r(0),i=r(1).code.ENOENT,s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),a.forEach(function(t){n(e,t,r[t])})}return e}({type:t},r))}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(e,null,[{key:"create",value:function(t){var r=e.ERR_TYPE__VALIDATION,n=t.code,a=t.message,i=t.path,s=t.cause,l=n||t.type||r,c={message:a};return r===l?o.merge(c,t):(i&&o.merge(c,{params:{path:i}}),s&&o.merge(c,s)),new e(l,c)}}]),e}();e.exports=s,s.ERR_TYPE__VALIDATION="Validation",s.ERR_TYPE__JSON_PATH_NOT_FOUND="JsonPathNotFound",s.ERR_TYPE__JS_ENOENT=i.code}]);
//# sourceMappingURL=cli.js.map