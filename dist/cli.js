#!/usr/bin/env node
module.exports=function(e){var a={};function t(r){if(a[r])return a[r].exports;var s=a[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=0)}([function(e,a,t){"use strict";var r=t(1).version,s=t(2),n=t(3),o=n.validateFile,i=n.validateExample,l=n.validateExamplesByMap;s.version(r).arguments("<filepath>").description("Validate embedded examples in Swagger-JSONs.\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","JSON-path to schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --map-filepath <map-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value").action(function(e,a){var t=a.schemaJsonpath,r=a.exampleFilepath,s=a.mapFilepath,n=null;s?(console.log("Validating with mapping file"),n=l(e,s)):t&&r?(console.log("Validating single external example"),n=i(e,t,r)):(console.log("Validating examples"),n=o(e));!function(e){a=e.statistics,t=["Response schemas with examples found: "+a.responseSchemasWithExamples,"Response examples without schema found: "+a.responseExamplesWithoutSchema,"Total examples found: "+a.responseExamplesTotal].join("\n"),process.stdout.write(t+"\n"),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));var a,t;process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(n)}),s.on("--help",function(){console.log("\n\n  Example for external example-file:\n"),console.log("    $ swagger-examples-validator -s $.paths./.get.responses.200.schema -e example.json swagger.json\n\n")}),s.parse(process.argv)},function(e,a){e.exports={name:"swagger-examples-validator",version:"0.5.2",description:"Validates embedded examples in Swagger-JSONs",main:"dist/index.js",bin:{"swagger-examples-validator":"dist/cli.js"},scripts:{build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test:mocha":'BABEL_DISABLE_CACHE=1 mocha --require "babel-register" --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/swagger-examples-validator.git"},keywords:["swagger","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/swagger-examples-validator/issues"},homepage:"https://github.com/codekie/swagger-examples-validator#readme",devDependencies:{"babel-cli":"^6.26.0","babel-core":"^6.26.0","babel-eslint":"^8.2.1","babel-loader":"^7.1.2","babel-plugin-transform-es2015-classes":"^6.24.1","babel-plugin-transform-es2015-parameters":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-es2015":"^6.24.1","babel-preset-es2015-webpack":"6.4.3","babel-register":"^6.26.0",chai:"^4.1.2",coveralls:"^3.0.0",eslint:"^4.17.0","eslint-loader":"^1.9.0","json-loader":"^0.5.7",mocha:"^5.0.1","mocha-lcov-reporter":"^1.3.0",nyc:"^11.4.1",rimraf:"^2.6.2","standard-version":"^4.3.0","uglifyjs-webpack-plugin":"1.1.8",webpack:"^3.11.0"},dependencies:{ajv:"^6.1.1",commander:"^2.14.1","jsonpath-plus":"0.16.0",lodash:"4.17.5"}}},function(e,a){e.exports=require("commander")},function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(){return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,a){var t=[],r=!0,s=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(t.push(o.value),!a||t.length!==a);r=!0);}catch(e){s=!0,n=e}finally{try{!r&&i.return&&i.return()}finally{if(s)throw n}}return t}(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function s(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}var n=t(4),o=t(5),i=t(6),l=t(7);a.default=m,a.validateFile=function(e){return m(JSON.parse(o.readFileSync(e,"utf-8")))},a.validateExample=function(e,a,t){var r=h({schemaPaths:[a]}),s=f({validator:v(),jsonSchema:JSON.parse(o.readFileSync(e,"utf-8")),pathResponseSchema:a,filePathExample:t,statistics:r});return{valid:!s.length,statistics:r,errors:s}},a.validateExamplesByMap=function(e,a){var t=JSON.parse(o.readFileSync(a,"utf-8")),s=h({schemaPaths:Object.keys(t)}),i=n(t).entries().flatMap(function(a){var t=r(a,2),i=t[0],l=t[1];return n([l]).flatten().flatMap(function(a){return f({validator:v(),jsonSchema:JSON.parse(o.readFileSync(e,"utf-8")),pathResponseSchema:i,filePathExample:a,statistics:s})}).value()}).value();return{valid:!i.length,statistics:s,errors:i}};var p="schema",c="examples",u="$.."+c+".application/json";function m(e){return function(e,a){var t=v(),r=function(e){return e.reduce(function(e,a){var t=function(e){var a=i.toPathArray(e).slice(),t=a.lastIndexOf(c);return a.splice(t,a.length-t,p),i.toPathString(a)}(a);return e[t]=a,e},{})}(e),n=Object.keys(r),o=h({schemaPaths:n}),l={valid:!0,statistics:o};return n.forEach(function(e){var n,i=f({validator:t,jsonSchema:a,pathResponseSchema:e,pathExample:r[e],statistics:o});if(i.length){l.valid=!1;var p=l.errors;p||(p=[],l.errors=p),(n=l.errors).splice.apply(n,[p.length-1,0].concat(s(i)))}}),l}(function(e){return i({json:e,path:u,resultType:"path"})}(e),e)}function h(e){return{responseSchemasWithExamples:e.schemaPaths.length,responseExamplesTotal:0,responseExamplesWithoutSchema:0}}function d(e,a){return i({json:a,path:e,flatten:!0,wrap:!1,resultType:"value"})}function f(e){var a=e.validator,t=e.jsonSchema,r=e.pathResponseSchema,n=e.pathExample,l=e.filePathExample,p=e.statistics,c=[],u=d(r,t),m=l?JSON.parse(o.readFileSync(l,"utf-8")):d(n,t);return p.responseExamplesTotal++,u?a.validate(u,m)?c:c.concat.apply(c,s(a.errors.map(function(e){return n?e.examplePath=i.toPointer(i.toPathArray(n)):e.exampleFilePath=l,e}))):(p.responseSchemasWithExamples--,p.responseExamplesWithoutSchema++,c)}function v(){return new l({allErrors:!0})}},function(e,a){e.exports=require("lodash")},function(e,a){e.exports=require("fs")},function(e,a){e.exports=require("jsonpath-plus")},function(e,a){e.exports=require("ajv")}]);
//# sourceMappingURL=cli.js.map