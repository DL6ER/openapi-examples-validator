module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports=require("jsonpath-plus")},function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("errno")},function(t,e,n){function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const o=n(1),i={jsENOENT:n(3).code.ENOENT.code,jsonPathNotFound:"JsonPathNotFound",errorAndErrorsMutuallyExclusive:"ErrorErrorsMutuallyExclusive",validation:"Validation"};class s{static create(t){const e=t.code,n=t.message,r=t.path,a=t.cause,c=e||t.type||i.validation,u={message:n};return i.validation===c||i.errorAndErrorsMutuallyExclusive===c?o.merge(u,t):(r&&o.merge(u,{params:{path:r}}),a&&o.merge(u,a)),new s(c,u)}constructor(t,e={}){Object.assign(this,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({type:t},e))}}t.exports={ApplicationError:s,ErrorType:i}},function(t,e,n){function r(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var i=t.apply(e,n);function s(t){o(i,r,a,s,c,"next",t)}function c(t){o(i,r,a,s,c,"throw",t)}s(void 0)}))}}const s=n(1),c=n(6),u=n(2),l=n(7),p=n(8),f=n(0).JSONPath,m=n(3).custom.createError,d=n(9),h=n(10),y=h.getValidatorFactory,x=h.compileValidate,g=n(16),v=n(4),b=v.ApplicationError,O=v.ErrorType,w=n(19),P=w.createValidationResponse,j=w.dereferenceJsonSchema,E=["yaml","yml"],S=m(O.jsonPathNotFound);function T(t){const e=g.getImplementation(t);t=e.prepare(t);let n=e.getJsonPathsToExamples().reduce((e,n)=>e.concat(function(t,e){return f({json:t,path:e,resultType:d.path})}(t,n)),[]);return function({impl:t},e,n){const r=k(),a={valid:!0,statistics:r,errors:[]},o=D(n);let i;try{i=t.buildValidationMap(e)}catch(t){if(!(t instanceof b))throw t;return a.valid=!1,a.errors.push(t),a}const s=Object.keys(i);return a.statistics.schemasWithExamples=s.length,s.forEach(t=>{!function({openapiSpec:t,createValidator:e,pathSchema:n,validationMap:r,statistics:a,validationResult:o}){const i=o.errors;r[n].forEach(r=>{const s=W(r,t),c=R(n,t,!0),u=_({createValidator:e,schema:c,example:s,statistics:a}).map(t=>(t.examplePath=f.toPointer(f.toPathArray(r)),t));u.length&&(o.valid=!1,i.splice(i.length-1,0,...u))})}({openapiSpec:n,createValidator:o,pathSchema:t,validationMap:i,statistics:r,validationResult:a})}),a}({impl:e},n,t)}function M(){return(M=i((function*(t){let e=null;try{e=yield A(t)}catch(t){return P({errors:[b.create(t)]})}return T(e)}))).apply(this,arguments)}function F(){return(F=i((function*(t,e,{cwdToMappingFile:n}={}){let a=0;let o=[];var i,p=r(l.sync(e,{nonull:!0}));try{for(p.s();!(i=p.n()).done;){let e=i.value,r=null,s=null;try{r=JSON.parse(c.readFileSync(e,"utf-8")),s=yield A(t),s=g.getImplementation(s).prepare(s)}catch(t){o.push(P({errors:[b.create(t)]}));continue}a++,o.push(V(Object.keys(r),t=>J(s,r,t,{cwdToMappingFile:n,dirPathMapExternalExamples:u.dirname(e)}).map(t=>Object.assign(t,{mapFilePath:e}))))}}catch(t){p.e(t)}finally{p.f()}return s.merge(o.reduce((t,e)=>t?I(t,e):e,null),{statistics:{matchingFilePathsMapping:a}})}))).apply(this,arguments)}function q(){return(q=i((function*(t,e,n){let r=null,a=null,o=null;try{r=JSON.parse(c.readFileSync(n,"utf-8")),o=yield A(t),o=g.getImplementation(o).prepare(o),a=R(e,o)}catch(t){return P({errors:[b.create(t)]})}return V([e],t=>_({createValidator:D(o),schema:a,example:r,statistics:t,filePathExample:n}))}))).apply(this,arguments)}function A(t){return N.apply(this,arguments)}function N(){return(N=i((function*(t){const e=$(t)?p.parse(c.readFileSync(t,"utf-8")):JSON.parse(c.readFileSync(t,"utf-8"));return yield j(t,e)}))).apply(this,arguments)}function $(t){const e=t.split(".").pop();return E.includes(e)}function V(t,e){const n=k({schemaPaths:t}),r=e(n);return P({errors:r,statistics:n})}function J(t,e,n,{cwdToMappingFile:r=!1,dirPathMapExternalExamples:a}){return s(e).entries().flatMap(([e,o])=>{let i=null;try{i=R(e,t)}catch(t){return b.create(t)}return s([o]).flatten().flatMap(e=>{let o=null;try{const t=r?u.join(a,e):e;o=JSON.parse(c.readFileSync(t,"utf-8"))}catch(t){return b.create(t)}return _({createValidator:D(t),schema:i,example:o,statistics:n,filePathExample:e})}).value()}).value()}function I(t,e){return P({errors:t.errors.concat(e.errors),statistics:s.entries(t.statistics).reduce((t,[n,r])=>(t[n]=r+e.statistics[n],t),k())})}function k({schemaPaths:t=[]}={}){return{schemasWithExamples:t.length,examplesTotal:0,examplesWithoutSchema:0}}function W(t,e){return f({json:e,path:t,flatten:!0,wrap:!1,resultType:d.value})}function _({createValidator:t,schema:e,example:n,statistics:r,filePathExample:a}){const o=[];if(r.examplesTotal++,!e)return r.schemasWithExamples--,r.examplesWithoutSchema++,o;const i=x(t(),e);return i(n)?o:o.concat(...i.errors.map(b.create)).map(t=>a?(t.exampleFilePath=a,t):t)}function D(t){return y(t,{allErrors:!0,nullable:!0})}function R(t,e,n=!1){const r=W(t,e);if(!n&&!r)throw new S(`Path to schema can't be found: '${t}'`,{params:{path:t}});return r}t.exports={default:T,validateFile:function(t){return M.apply(this,arguments)},validateExample:function(t,e,n){return q.apply(this,arguments)},validateExamplesByMap:function(t,e){return F.apply(this,arguments)}}},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("glob")},function(t,e){t.exports=require("yaml")},function(t,e){t.exports={parent:"parent",parentProperty:"parentProperty",path:"path",pointer:"pointer",value:"value"}},function(t,e,n){const r=n(0).JSONPath,a=n(11),o=n(12),i=n(13),s="https://www.npmjs.com/package/openapi-examples-validator/defs.json";function c(t){r({path:"$..$ref",json:t,callback(t,e,n){t.startsWith("#")&&(n.parent[n.parentProperty]=`${s}${t}`)}})}t.exports={getValidatorFactory:function(t,e){const n=function(t){const e={$id:s};return r({path:"$..$ref",json:t,callback(n){if(!n.startsWith("#"))return;const r=n.substring(1),o=a.get(t,r);a.set(e,r,o)}}),e}(t);return()=>{const t=new o(e);return t.addSchema(n),function(t){t.addFormat("int32",{type:"number",validate:i.int32}),t.addFormat("int64",{type:"string",validate:i.int64}),t.addFormat("float",{type:"number",validate:i.float}),t.addFormat("double",{type:"number",validate:i.double}),t.addFormat("byte",{type:"string",validate:i.byte})}(t),t}},compileValidate:function(t,e){const n=function(t,e){const n=Object.assign({},t);return n.$id=e,n}(e,"https://www.npmjs.com/package/openapi-examples-validator/schema.json");return c(n),t.compile(n)}}},function(t,e){t.exports=require("json-pointer")},function(t,e){t.exports=require("ajv")},function(t,e,n){const r=n(14);t.exports={int32:function(t){return Number.isInteger(+t)&&r.int32.max.greaterThanOrEqualTo(t)&&r.int32.min.lessThanOrEqualTo(t)},int64:function(t){return Number.isInteger(+t)&&r.int64.max.greaterThanOrEqualTo(t)&&r.int64.min.lessThanOrEqualTo(t)},float:function(t){return r.float.max.greaterThanOrEqualTo(t)&&r.float.min.lessThanOrEqualTo(t)},double:function(t){return r.double.max.greaterThanOrEqualTo(t)&&r.double.min.lessThanOrEqualTo(t)},byte:function(t){const e=t.length;if(!e||e%4!=0||/[^A-Z0-9+\/=]/i.test(t))return!1;const n=t.indexOf("=");return-1===n||n===e-1||n===e-2&&"="===t[e-1]}}},function(t,e,n){const r=n(15),a={byte:{min:new r("-128"),max:new r("127")},int32:{min:new r("-2147483648"),max:new r("2147483647")},int64:{min:new r("-9223372036854775808"),max:new r("9223372036854775807")},float:{min:new r(2).pow(128).negated(),max:new r(2).pow(128)},double:{min:new r(2).pow(1024).negated(),max:new r(2).pow(1024)}};t.exports=a},function(t,e){t.exports=require("decimal.js")},function(t,e,n){const r=n(17),a=n(18),o=/^3\./;t.exports={getImplementation:function(t){if("string"==typeof t.swagger)return r;if(t.openapi&&t.openapi.match(o))return a;return null}}},function(t,e,n){const r=n(0).JSONPath;t.exports={buildValidationMap:function(t){return t.reduce((t,e)=>{const n=function(t){const e=r.toPathArray(t).slice(),n=e.lastIndexOf("examples");return e.splice(n,e.length-n,"schema"),r.toPathString(e)}(e);return t[n]=(t[n]||new Set).add(e),t},{})},getJsonPathsToExamples:function(){return["$..examples.application/json"]},prepare:function(t){return t}}},function(t,e,n){const r=n(0).JSONPath,a=n(4),o=a.ApplicationError,i=a.ErrorType,s="single",c="multi";t.exports={buildValidationMap:function(t){const e=new Map;return t.reduce((t,n)=>{const a=function(t){const e=r.toPathArray(t).slice(),n=e.lastIndexOf("example"),a=n>-1?s:c,o=a===s?n:e.lastIndexOf("examples");return e.splice(o,e.length-o,"schema"),{exampleType:a,pathSchemaAsArray:e}}(n),u=a.pathSchemaAsArray,l=a.exampleType,p=r.toPathString(u),f=e.get(p);return f&&f!==l&&function(t){const e=t.slice(0,t.length-1);throw o.create({type:i.errorAndErrorsMutuallyExclusive,message:'Properties "error" and "errors" are mutually exclusive',params:{pathContext:r.toPointer(e)}})}(u),e.set(p,l),t[p]=(t[p]||new Set).add(n),t},{})},getJsonPathsToExamples:function(){return["$..responses..content.application/json.example","$..responses..content.application/json.examples..value","$..parameters..example","$..parameters..examples..value","$..requestBody.content.application/json.example","$..requestBody.content.application/json.examples..value"]},prepare:function(t){return t}}},function(t,e,n){function r(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var i=t.apply(e,n);function s(t){r(i,a,o,s,c,"next",t)}function c(t){r(i,a,o,s,c,"throw",t)}s(void 0)}))}}const o=n(2),i=n(20);function s(){return(s=a((function*(t,e){const n=process.cwd();process.chdir(o.dirname(t));const r=yield i.dereference(e);return process.chdir(n),r}))).apply(this,arguments)}t.exports={createValidationResponse:function({errors:t,statistics:e={}}){return{valid:!t.length,statistics:e,errors:t}},dereferenceJsonSchema:function(t,e){return s.apply(this,arguments)}}},function(t,e){t.exports=require("json-schema-ref-parser")}]);
//# sourceMappingURL=index.js.map