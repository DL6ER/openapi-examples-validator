module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e){t.exports=require("jsonpath-plus")},function(t,e){t.exports=require("lodash.merge")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("json-schema-ref-parser")},function(t,e){t.exports=require("errno")},function(t,e){t.exports={parent:"parent",parentProperty:"parentProperty",path:"path",pointer:"pointer",value:"value"}},function(t,e,r){function n(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw i}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}const a=r(0).JSONPath,i=r(5),s=["$..application/json.schema",'$..schema..[?(@.properties && (@property === "schema" || @property === "items" || @.type === "object"))]'];function c(t){t.additionalProperties=!1}function l(t,e,r=i.path,n){return a({json:t,path:e,flatten:!0,resultType:r,callback:n})}t.exports={setNoAdditionalProperties:function(t,e=[],r=c){const o=new Set;s.forEach(e=>{l(t,e).forEach(t=>o.add(t))}),function(t,e,r){r.forEach(r=>{l(t,r).forEach(t=>{var r,o=n(e);try{for(o.s();!(r=o.n()).done;){const n=r.value;n.startsWith(t)&&e.delete(n)}}catch(t){o.e(t)}finally{o.f()}})})}(t,o,e);var a,u=n(o);try{for(u.s();!(a=u.n()).done;){const e=a.value;l(t,e,i.value,r)}}catch(t){u.e(t)}finally{u.f()}}}},function(t,e){t.exports=require("lodash.clonedeep")},function(t,e,r){function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const a=r(1),i={jsENOENT:r(4).code.ENOENT.code,jsonPathNotFound:"JsonPathNotFound",errorAndErrorsMutuallyExclusive:"ErrorErrorsMutuallyExclusive",parseError:"ParseError",validation:"Validation"};class s{static create(t){const e=t.code,r=t.message,n=t.path,o=t.cause,c=e||t.type||i.validation,l={message:r};return i.validation===c||i.errorAndErrorsMutuallyExclusive===c?a(l,t):(n&&a(l,{params:{path:n}}),o&&a(l,o)),new s(c,l)}constructor(t,e={}){Object.assign(this,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({type:t},e))}}t.exports={ApplicationError:s,ErrorType:i}},function(t,e,r){function n(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw i}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function s(t){a(i,n,o,s,c,"next",t)}function c(t){a(i,n,o,s,c,"throw",t)}s(void 0)}))}}const s=r(1),c=r(10),l=r(11),u=r(12),p=r(2),f=r(13),d=r(14),m=r(0).JSONPath,h=r(3),y=r(4).custom.createError,x=r(5),b=r(15),v=b.getValidatorFactory,g=b.compileValidate,P=r(21),E=r(8),w=E.ApplicationError,O=E.ErrorType,j=r(24),S=j.createValidationResponse,A=j.dereferenceJsonSchema,T=Symbol("internal"),q=["yaml","yml"],M=y(O.jsonPathNotFound);function F(t){return $.apply(this,arguments)}function $(){return($=i((function*(t,{noAdditionalProperties:e}={}){const r=P.getImplementation(t);t=yield h.dereference(t),t=r.prepare(t,{noAdditionalProperties:e});let n=r.getJsonPathsToExamples().reduce((e,r)=>e.concat(B(t,r)),[]);return C({impl:r},n,t)}))).apply(this,arguments)}function N(){return(N=i((function*(t,{noAdditionalProperties:e}={}){let r=null;try{r=yield J(t)}catch(t){return S({errors:[w.create(t)]})}return F(r,{noAdditionalProperties:e})}))).apply(this,arguments)}function V(){return(V=i((function*(t,e,{cwdToMappingFile:r,noAdditionalProperties:o}={}){let a=0;let i=[];var c,l=n(f.sync(e,{nonull:!0}));try{for(l.s();!(c=l.n()).done;){let e=c.value,n=null,s=null;try{n=JSON.parse(u.readFileSync(e,"utf-8")),s=yield J(t),s=P.getImplementation(s).prepare(s,{noAdditionalProperties:o})}catch(t){i.push(S({errors:[w.create(t)]}));continue}a++,i.push(_(t=>D(s,n,t,{cwdToMappingFile:r,dirPathMapExternalExamples:p.dirname(e)}).map(t=>Object.assign(t,{mapFilePath:e}))))}}catch(t){l.e(t)}finally{l.f()}return s(i.reduce((t,e)=>t?R(t,e):e,null),{statistics:{matchingFilePathsMapping:a}})}))).apply(this,arguments)}function I(){return(I=i((function*(t,e,r,{noAdditionalProperties:n}={}){let o=null,a=null,i=null;try{o=JSON.parse(u.readFileSync(r,"utf-8")),i=yield J(t),i=P.getImplementation(i).prepare(i,{noAdditionalProperties:n}),a=H(e,i)}catch(t){return S({errors:[w.create(t)]})}return _(t=>Z({createValidator:G(i),schema:a,example:o,statistics:t,filePathExample:r}))}))).apply(this,arguments)}function J(t){return W.apply(this,arguments)}function W(){return(W=i((function*(t){let e;if(k(t))try{e=d.parse(u.readFileSync(t,"utf-8"))}catch(t){const e=t.name,r=t.message;throw new w(O.parseError,{message:`${e}: ${r}`})}else e=JSON.parse(u.readFileSync(t,"utf-8"));return yield A(t,e)}))).apply(this,arguments)}function k(t){const e=t.split(".").pop();return q.includes(e)}function _(t){const e=U(),r=t(e);return S({errors:r,statistics:e})}function D(t,e,r,{cwdToMappingFile:n=!1,dirPathMapExternalExamples:o}){return l(Object.entries(e),([e,a])=>{let i=null;try{i=H(e,t)}catch(t){return w.create(t)}return l(c([a]),e=>{let a=null;try{const t=n?p.join(o,e):e;a=JSON.parse(u.readFileSync(t,"utf-8"))}catch(t){return[w.create(t)]}return Z({createValidator:G(t),schema:i,example:a,statistics:r,filePathExample:e})})})}function R(t,e){return S({errors:t.errors.concat(e.errors),statistics:Object.entries(t.statistics).reduce((r,[o,a])=>"schemasWithExamples"===o?([t,e].forEach(t=>{var e,o=n(t.statistics[T].schemasWithExamples.values());try{for(o.s();!(e=o.n()).done;){let t=e.value;r[T].schemasWithExamples.add(t)}}catch(t){o.e(t)}finally{o.f()}}),r):(r[o]=a+e.statistics[o],r),U())})}function B(t,e){return m({json:t,path:e,resultType:x.path})}function C({impl:t},e,r){const n=U(),o={valid:!0,statistics:n,errors:[]},a=G(r);let i;try{i=t.buildValidationMap(e)}catch(t){if(!(t instanceof w))throw t;return o.valid=!1,o.errors.push(t),o}return Object.keys(i).forEach(t=>{!function({openapiSpec:t,createValidator:e,pathSchema:r,validationMap:n,statistics:o,validationResult:a}){const i=a.errors;n[r].forEach(n=>{const s=z(n,t),c=H(r,t,!0),l=Z({createValidator:e,schema:c,example:s,statistics:o}).map(t=>(t.examplePath=m.toPointer(m.toPathArray(n)),t));l.length&&(a.valid=!1,i.splice(i.length-1,0,...l))})}({openapiSpec:r,createValidator:a,pathSchema:t,validationMap:i,statistics:n,validationResult:o})}),o}function U(){const t={[T]:{schemasWithExamples:new Set},examplesTotal:0,examplesWithoutSchema:0};return Object.defineProperty(t,"schemasWithExamples",{enumerable:!0,get:()=>t[T].schemasWithExamples.size}),t}function z(t,e){return m({json:e,path:t,flatten:!0,wrap:!1,resultType:x.value})}function Z({createValidator:t,schema:e,example:r,statistics:n,filePathExample:o}){const a=[];if(n.examplesTotal++,!e)return n.examplesWithoutSchema++,a;n[T].schemasWithExamples.add(e);const i=g(t(),e);return i(r)?a:a.concat(...i.errors.map(w.create)).map(t=>o?(t.exampleFilePath=o,t):t)}function G(t){return v(t,{allErrors:!0,nullable:!0})}function H(t,e,r=!1){const n=z(t,e);if(!r&&!n)throw new M(`Path to schema can't be found: '${t}'`,{params:{path:t}});return n}t.exports={default:F,validateFile:function(t){return N.apply(this,arguments)},validateExample:function(t,e,r){return I.apply(this,arguments)},validateExamplesByMap:function(t,e){return V.apply(this,arguments)}}},function(t,e){t.exports=require("lodash.flatten")},function(t,e){t.exports=require("lodash.flatmap")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("glob")},function(t,e){t.exports=require("yaml")},function(t,e,r){const n=r(0).JSONPath,o=r(16),a=r(17),i=r(18),s="https://www.npmjs.com/package/openapi-examples-validator/defs.json";function c(t){n({path:"$..$ref",json:t,callback(t,e,r){t.startsWith("#")&&(r.parent[r.parentProperty]=`${s}${t}`)}})}t.exports={getValidatorFactory:function(t,e){const r=function(t){const e={$id:s};return n({path:"$..$ref",json:t,callback(r){if(!r.startsWith("#"))return;const n=r.substring(1),a=o.get(t,n);o.set(e,n,a)}}),e}(t);return()=>{const t=new a(e);return t.addSchema(r),function(t){t.addFormat("int32",{type:"number",validate:i.int32}),t.addFormat("int64",{type:"string",validate:i.int64}),t.addFormat("float",{type:"number",validate:i.float}),t.addFormat("double",{type:"number",validate:i.double}),t.addFormat("byte",{type:"string",validate:i.byte})}(t),t}},compileValidate:function(t,e){const r=function(t,e){const r=Object.assign({},t);return r.$id=e,r}(e,"https://www.npmjs.com/package/openapi-examples-validator/schema.json");return c(r),t.compile(r)}}},function(t,e){t.exports=require("json-pointer")},function(t,e){t.exports=require("ajv")},function(t,e,r){const n=r(19);t.exports={int32:function(t){return Number.isInteger(+t)&&n.int32.max.greaterThanOrEqualTo(t)&&n.int32.min.lessThanOrEqualTo(t)},int64:function(t){return Number.isInteger(+t)&&n.int64.max.greaterThanOrEqualTo(t)&&n.int64.min.lessThanOrEqualTo(t)},float:function(t){return n.float.max.greaterThanOrEqualTo(t)&&n.float.min.lessThanOrEqualTo(t)},double:function(t){return n.double.max.greaterThanOrEqualTo(t)&&n.double.min.lessThanOrEqualTo(t)},byte:function(t){const e=t.length;if(!e||e%4!=0||/[^A-Z0-9+\/=]/i.test(t))return!1;const r=t.indexOf("=");return-1===r||r===e-1||r===e-2&&"="===t[e-1]}}},function(t,e,r){const n=r(20),o={byte:{min:new n("-128"),max:new n("127")},int32:{min:new n("-2147483648"),max:new n("2147483647")},int64:{min:new n("-9223372036854775808"),max:new n("9223372036854775807")},float:{min:new n(2).pow(128).negated(),max:new n(2).pow(128)},double:{min:new n(2).pow(1024).negated(),max:new n(2).pow(1024)}};t.exports=o},function(t,e){t.exports=require("decimal.js")},function(t,e,r){const n=r(22),o=r(23),a=/^3\./;t.exports={getImplementation:function(t){if("string"==typeof t.swagger)return n;if(t.openapi&&t.openapi.match(a))return o;return null}}},function(t,e,r){const n=r(0).JSONPath,o=r(6).setNoAdditionalProperties,a=r(7);function i(){return["$..examples.application/json"]}t.exports={buildValidationMap:function(t){return t.reduce((t,e)=>{const r=function(t){const e=n.toPathArray(t).slice(),r=e.lastIndexOf("examples");return e.splice(r,e.length-r,"schema"),n.toPathString(e)}(e);return t[r]=(t[r]||new Set).add(e),t},{})},getJsonPathsToExamples:i,prepare:function(t,{noAdditionalProperties:e}={}){const r=a(t);return e&&o(r,i()),r}}},function(t,e,r){const n=r(0).JSONPath,o=r(7),a=r(8),i=a.ApplicationError,s=a.ErrorType,c=r(6).setNoAdditionalProperties,l="single",u="multi";function p(){return["$..responses..content.application/json.example","$..responses..content.application/json.examples.*.value","$..parameters..example","$..parameters..examples.*.value","$..requestBody.content.application/json.example","$..requestBody.content.application/json.examples.*.value"]}t.exports={buildValidationMap:function(t){const e=new Map;return t.reduce((t,r)=>{const o=function(t){const e=n.toPathArray(t).slice(),r=e.lastIndexOf("example"),o=r>-1?l:u,a=o===l?r:e.lastIndexOf("examples");return e.splice(a,e.length-a,"schema"),{exampleType:o,pathSchemaAsArray:e}}(r),a=o.pathSchemaAsArray,c=o.exampleType,p=n.toPathString(a),f=e.get(p);return f&&f!==c&&function(t){const e=t.slice(0,t.length-1);throw i.create({type:s.errorAndErrorsMutuallyExclusive,message:'Properties "error" and "errors" are mutually exclusive',params:{pathContext:n.toPointer(e)}})}(a),e.set(p,c),t[p]=(t[p]||new Set).add(r),t},{})},getJsonPathsToExamples:p,prepare:function(t,{noAdditionalProperties:e}={}){const r=o(t);return e&&c(r,p()),r}}},function(t,e,r){function n(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,a){var i=t.apply(e,r);function s(t){n(i,o,a,s,c,"next",t)}function c(t){n(i,o,a,s,c,"throw",t)}s(void 0)}))}}const a=r(2),i=r(3);function s(){return(s=o((function*(t,e){const r=process.cwd();process.chdir(a.dirname(t));const n=yield i.dereference(e);return process.chdir(r),n}))).apply(this,arguments)}t.exports={createValidationResponse:function({errors:t,statistics:e={}}){return{valid:!t.length,statistics:e,errors:t}},dereferenceJsonSchema:function(t,e){return s.apply(this,arguments)}}}]);
//# sourceMappingURL=index.js.map