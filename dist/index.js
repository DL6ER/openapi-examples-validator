module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("lodash.merge")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("json-schema-ref-parser")},function(e,t){e.exports=require("errno")},function(e,t){e.exports={parent:"parent",parentProperty:"parentProperty",path:"path",pointer:"pointer",value:"value"}},function(e,t,r){const{JSONPath:n}=r(0),a=r(5),o=["$..application/json.schema",'$..schema..[?(@.properties && (@property === "schema" || @property === "items" || @.type === "object"))]'];function i(e){e.additionalProperties=!1}function s(e,t,r=a.path,o){return n({json:e,path:t,flatten:!0,resultType:r,callback:o})}e.exports={setNoAdditionalProperties:function(e,t=[],r=i){const n=new Set;o.forEach(t=>{s(e,t).forEach(e=>n.add(e))}),function(e,t,r){r.forEach(r=>{s(e,r).forEach(e=>{for(const r of t)r.startsWith(e)&&t.delete(r)})})}(e,n,t);for(const t of n)s(e,t,a.value,r)}}},function(e,t){e.exports=require("lodash.clonedeep")},function(e,t,r){const n=r(1),{ENOENT:a}=r(4).code,o={jsENOENT:a.code,jsonPathNotFound:"JsonPathNotFound",errorAndErrorsMutuallyExclusive:"ErrorErrorsMutuallyExclusive",parseError:"ParseError",validation:"Validation"};class i{static create(e){const{code:t,message:r,path:a,cause:s}=e,c=t||e.type||o.validation,l={message:r};return o.validation===c||o.errorAndErrorsMutuallyExclusive===c?n(l,e):(a&&n(l,{params:{path:a}}),s&&n(l,s)),new i(c,l)}constructor(e,t={}){Object.assign(this,{type:e,...t})}}e.exports={ApplicationError:i,ErrorType:o}},function(e,t,r){const n=r(1),a=r(10),o=r(11),i=r(12),s=r(2),c=r(13),l=r(14),{JSONPath:p}=r(0),u=r(3),{createError:d}=r(4).custom,m=r(5),{getValidatorFactory:f,compileValidate:h}=r(15),x=r(21),{ApplicationError:y,ErrorType:g}=r(8),{createValidationResponse:E,dereferenceJsonSchema:P}=r(24),b=Symbol("internal"),w=["yaml","yml"],v=d(g.jsonPathNotFound);async function j(e,{noAdditionalProperties:t}={}){const r=x.getImplementation(e);e=await u.dereference(e),e=r.prepare(e,{noAdditionalProperties:t});let n=r.getJsonPathsToExamples().reduce((t,r)=>t.concat(function(e,t){return p({json:e,path:t,resultType:m.path})}(e,r)),[]);return function({impl:e},t,r){const n=A(),a={valid:!0,statistics:n,errors:[]},o=M(r);let i;try{i=e.buildValidationMap(t)}catch(e){if(!(e instanceof y))throw e;return a.valid=!1,a.errors.push(e),a}return Object.keys(i).forEach(e=>{!function({openapiSpec:e,createValidator:t,pathSchema:r,validationMap:n,statistics:a,validationResult:o}){const i=o.errors;n[r].forEach(n=>{const s=q(n,e),c=N(r,e,!0),l=F({createValidator:t,schema:c,example:s,statistics:a}).map(e=>(e.examplePath=p.toPointer(p.toPathArray(n)),e));l.length&&(o.valid=!1,i.splice(i.length-1,0,...l))})}({openapiSpec:r,createValidator:o,pathSchema:e,validationMap:i,statistics:n,validationResult:a})}),a}({impl:r},n,e)}async function O(e){let t;if(function(e){const t=e.split(".").pop();return w.includes(t)}(e))try{t=l.parse(i.readFileSync(e,"utf-8"))}catch(e){const{name:t,message:r}=e;throw new y(g.parseError,{message:`${t}: ${r}`})}else t=JSON.parse(i.readFileSync(e,"utf-8"));return await P(e,t)}function S(e){const t=A(),r=e(t);return E({errors:r,statistics:t})}function T(e,t,r,{cwdToMappingFile:n=!1,dirPathMapExternalExamples:c}){return o(Object.entries(t),([t,l])=>{let p=null;try{p=N(t,e)}catch(e){return y.create(e)}return o(a([l]),t=>{let a=null;try{const e=n?s.join(c,t):t;a=JSON.parse(i.readFileSync(e,"utf-8"))}catch(e){return[y.create(e)]}return F({createValidator:M(e),schema:p,example:a,statistics:r,filePathExample:t})})})}function A(){const e={[b]:{schemasWithExamples:new Set},examplesTotal:0,examplesWithoutSchema:0};return Object.defineProperty(e,"schemasWithExamples",{enumerable:!0,get:()=>e[b].schemasWithExamples.size}),e}function q(e,t){return p({json:t,path:e,flatten:!0,wrap:!1,resultType:m.value})}function F({createValidator:e,schema:t,example:r,statistics:n,filePathExample:a}){const o=[];if(n.examplesTotal++,!t)return n.examplesWithoutSchema++,o;n[b].schemasWithExamples.add(t);const i=h(e(),t);return i(r)?o:o.concat(...i.errors.map(y.create)).map(e=>a?(e.exampleFilePath=a,e):e)}function M(e){return f(e,{allErrors:!0,nullable:!0})}function N(e,t,r=!1){const n=q(e,t);if(!r&&!n)throw new v(`Path to schema can't be found: '${e}'`,{params:{path:e}});return n}e.exports={default:j,validateFile:async function(e,{noAdditionalProperties:t}={}){let r=null;try{r=await O(e)}catch(e){return E({errors:[y.create(e)]})}return j(r,{noAdditionalProperties:t})},validateExample:async function(e,t,r,{noAdditionalProperties:n}={}){let a=null,o=null,s=null;try{a=JSON.parse(i.readFileSync(r,"utf-8")),s=await O(e),s=x.getImplementation(s).prepare(s,{noAdditionalProperties:n}),o=N(t,s)}catch(e){return E({errors:[y.create(e)]})}return S(e=>F({createValidator:M(s),schema:o,example:a,statistics:e,filePathExample:r}))},validateExamplesByMap:async function(e,t,{cwdToMappingFile:r,noAdditionalProperties:a}={}){let o=0;const l=c.sync(t,{nonull:!0});let p=[];for(let t of l){let n=null,c=null;try{n=JSON.parse(i.readFileSync(t,"utf-8")),c=await O(e),c=x.getImplementation(c).prepare(c,{noAdditionalProperties:a})}catch(e){p.push(E({errors:[y.create(e)]}));continue}o++,p.push(S(e=>T(c,n,e,{cwdToMappingFile:r,dirPathMapExternalExamples:s.dirname(t)}).map(e=>Object.assign(e,{mapFilePath:t}))))}return n(p.reduce((e,t)=>{return e?(n=t,E({errors:(r=e).errors.concat(n.errors),statistics:Object.entries(r.statistics).reduce((e,[t,a])=>"schemasWithExamples"===t?([r,n].forEach(t=>{const r=t.statistics[b].schemasWithExamples.values();for(let t of r)e[b].schemasWithExamples.add(t)}),e):(e[t]=a+n.statistics[t],e),A())})):t;var r,n},null),{statistics:{matchingFilePathsMapping:o}})}}},function(e,t){e.exports=require("lodash.flatten")},function(e,t){e.exports=require("lodash.flatmap")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("yaml")},function(e,t,r){const{JSONPath:n}=r(0),a=r(16),o=r(17),i=r(18),s="https://www.npmjs.com/package/openapi-examples-validator/defs.json";function c(e){n({path:"$..$ref",json:e,callback(e,t,r){e.startsWith("#")&&(r.parent[r.parentProperty]=`${s}${e}`)}})}e.exports={getValidatorFactory:function(e,t){const r=function(e){const t={$id:s};return n({path:"$..$ref",json:e,callback(r){if(!r.startsWith("#"))return;const n=r.substring(1),o=a.get(e,n);a.set(t,n,o)}}),t}(e);return()=>{const e=new o(t);return e.addSchema(r),function(e){e.addFormat("int32",{type:"number",validate:i.int32}),e.addFormat("int64",{type:"string",validate:i.int64}),e.addFormat("float",{type:"number",validate:i.float}),e.addFormat("double",{type:"number",validate:i.double}),e.addFormat("byte",{type:"string",validate:i.byte})}(e),e}},compileValidate:function(e,t){const r=function(e,t){const r=Object.assign({},e);return r.$id=t,r}(t,"https://www.npmjs.com/package/openapi-examples-validator/schema.json");return c(r),e.compile(r)}}},function(e,t){e.exports=require("json-pointer")},function(e,t){e.exports=require("ajv")},function(e,t,r){const n=r(19);e.exports={int32:function(e){return Number.isInteger(+e)&&n.int32.max.greaterThanOrEqualTo(e)&&n.int32.min.lessThanOrEqualTo(e)},int64:function(e){return Number.isInteger(+e)&&n.int64.max.greaterThanOrEqualTo(e)&&n.int64.min.lessThanOrEqualTo(e)},float:function(e){return n.float.max.greaterThanOrEqualTo(e)&&n.float.min.lessThanOrEqualTo(e)},double:function(e){return n.double.max.greaterThanOrEqualTo(e)&&n.double.min.lessThanOrEqualTo(e)},byte:function(e){const t=e.length;if(!t||t%4!=0||/[^A-Z0-9+\/=]/i.test(e))return!1;const r=e.indexOf("=");return-1===r||r===t-1||r===t-2&&"="===e[t-1]}}},function(e,t,r){const n=r(20),a={byte:{min:new n("-128"),max:new n("127")},int32:{min:new n("-2147483648"),max:new n("2147483647")},int64:{min:new n("-9223372036854775808"),max:new n("9223372036854775807")},float:{min:new n(2).pow(128).negated(),max:new n(2).pow(128)},double:{min:new n(2).pow(1024).negated(),max:new n(2).pow(1024)}};e.exports=a},function(e,t){e.exports=require("decimal.js")},function(e,t,r){const n=r(22),a=r(23),o=/^3\./;e.exports={getImplementation:function(e){if("string"==typeof e.swagger)return n;if(e.openapi&&e.openapi.match(o))return a;return null}}},function(e,t,r){const{JSONPath:n}=r(0),{setNoAdditionalProperties:a}=r(6),o=r(7);function i(){return["$..examples.application/json"]}e.exports={buildValidationMap:function(e){return e.reduce((e,t)=>{const r=function(e){const t=n.toPathArray(e).slice(),r=t.lastIndexOf("examples");return t.splice(r,t.length-r,"schema"),n.toPathString(t)}(t);return e[r]=(e[r]||new Set).add(t),e},{})},getJsonPathsToExamples:i,prepare:function(e,{noAdditionalProperties:t}={}){const r=o(e);return t&&a(r,i()),r}}},function(e,t,r){const{JSONPath:n}=r(0),a=r(7),{ApplicationError:o,ErrorType:i}=r(8),{setNoAdditionalProperties:s}=r(6),c="single",l="multi";function p(){return["$..responses..content.application/json.example","$..responses..content.application/json.examples.*.value","$..parameters..example","$..parameters..examples.*.value","$..requestBody.content.application/json.example","$..requestBody.content.application/json.examples.*.value"]}e.exports={buildValidationMap:function(e){const t=new Map;return e.reduce((e,r)=>{const{pathSchemaAsArray:a,exampleType:s}=function(e){const t=n.toPathArray(e).slice(),r=t.lastIndexOf("example"),a=r>-1?c:l,o=a===c?r:t.lastIndexOf("examples");return t.splice(o,t.length-o,"schema"),{exampleType:a,pathSchemaAsArray:t}}(r),p=n.toPathString(a),u=t.get(p);return u&&u!==s&&function(e){const t=e.slice(0,e.length-1);throw o.create({type:i.errorAndErrorsMutuallyExclusive,message:'Properties "error" and "errors" are mutually exclusive',params:{pathContext:n.toPointer(t)}})}(a),t.set(p,s),e[p]=(e[p]||new Set).add(r),e},{})},getJsonPathsToExamples:p,prepare:function(e,{noAdditionalProperties:t}={}){const r=a(e);return t&&s(r,p()),r}}},function(e,t,r){const n=r(2),a=r(3);e.exports={createValidationResponse:function({errors:e,statistics:t={}}){return{valid:!e.length,statistics:t,errors:e}},dereferenceJsonSchema:async function(e,t){const r=process.cwd();process.chdir(n.dirname(e));const o=await a.dereference(t);return process.chdir(r),o}}}]);
//# sourceMappingURL=index.js.map