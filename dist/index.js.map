{"version":3,"sources":["webpack:///index.js","webpack:///webpack/bootstrap bc91a0c58cf69db78d42","webpack:///./src/index.js","webpack:///external \"fs\"","webpack:///external \"jsonpath-plus\"","webpack:///external \"ajv\""],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","validateExamples","jsonSchema","pathsExamples","_extractExamplePaths","_validateExamplesPaths","validateFile","filePath","JSON","parse","fs","readFileSync","jsonPath","json","path","PATH__EXAMPLES","resultType","validator","_createValidator","validationMap","_buildValidationMap","schemaPaths","Object","keys","statistics","_initStatistics","validationResult","valid","forEach","pathResponseSchema","_validationResult$err","pathsExamplesForSchema","curErrors","_validateExamples","errors","splice","apply","concat","_ref","responseSchemasWithExamples","responseExamplesTotal","responseExamplesWithoutSchema","_getObjectByPath","schema","wrap","_getExamples","pathExamples","result","flatten","reduce","pathExample","pathSchema","_getSchemaPathOfExample","_ref2","examples","example","idxExample","validate","map","error","examplePath","toPointer","toPathArray","pathSegs","slice","idxExamples","lastIndexOf","PROP__EXAMPLES","PROP__SCHEMA","toPathString","Ajv","allErrors","defineProperty","value","default","require"],"mappings":"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","file":"index.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\tvar fs = __webpack_require__(1),\n\t    jsonPath = __webpack_require__(2),\n\t    Ajv = __webpack_require__(3);\n\t\n\t// PUBLIC API\n\t\n\texports.default = validateExamples;\n\texports.validateFile = validateFile;\n\t\n\t// IMPLEMENTATION DETAILS\n\t\n\tvar PROP__SCHEMA = 'schema',\n\t    PROP__EXAMPLES = 'examples',\n\t    PATH__EXAMPLES = '$..' + PROP__EXAMPLES + '.application/json';\n\t\n\t// Public\n\t\n\tfunction validateExamples(jsonSchema) {\n\t    var pathsExamples = _extractExamplePaths(jsonSchema);\n\t    return _validateExamplesPaths(pathsExamples, jsonSchema);\n\t}\n\t\n\tfunction validateFile(filePath) {\n\t    var jsonSchema = JSON.parse(fs.readFileSync(filePath, 'utf-8'));\n\t    return validateExamples(jsonSchema);\n\t}\n\t\n\t// Private\n\t\n\tfunction _extractExamplePaths(jsonSchema) {\n\t    return jsonPath({\n\t        json: jsonSchema,\n\t        path: PATH__EXAMPLES,\n\t        resultType: 'path'\n\t    });\n\t}\n\t\n\tfunction _validateExamplesPaths(pathsExamples, jsonSchema) {\n\t    var validator = _createValidator(),\n\t        validationMap = _buildValidationMap(pathsExamples),\n\t        schemaPaths = Object.keys(validationMap),\n\t        statistics = _initStatistics({ schemaPaths: schemaPaths }),\n\t        validationResult = {\n\t        valid: true,\n\t        statistics: statistics\n\t    };\n\t    schemaPaths.forEach(function (pathResponseSchema) {\n\t        var _validationResult$err;\n\t\n\t        var pathsExamplesForSchema = validationMap[pathResponseSchema],\n\t            curErrors = _validateExamples({ validator: validator, jsonSchema: jsonSchema, pathResponseSchema: pathResponseSchema,\n\t            pathsExamples: pathsExamplesForSchema, statistics: statistics });\n\t        if (!curErrors.length) {\n\t            return;\n\t        }\n\t        validationResult.valid = false;\n\t        var errors = validationResult.errors;\n\t        if (!errors) {\n\t            errors = [];\n\t            validationResult.errors = errors;\n\t        }\n\t        (_validationResult$err = validationResult.errors).splice.apply(_validationResult$err, [errors.length - 1, 0].concat(_toConsumableArray(curErrors)));\n\t    });\n\t    return validationResult;\n\t}\n\t\n\tfunction _initStatistics(_ref) {\n\t    var schemaPaths = _ref.schemaPaths;\n\t\n\t    return {\n\t        responseSchemasWithExamples: schemaPaths.length,\n\t        responseExamplesTotal: 0,\n\t        responseExamplesWithoutSchema: 0\n\t    };\n\t}\n\t\n\tfunction _getObjectByPath(path, schema) {\n\t    return jsonPath({\n\t        json: schema,\n\t        path: path,\n\t        wrap: false,\n\t        resultType: 'value'\n\t    });\n\t}\n\t\n\tfunction _getExamples(pathExamples, jsonSchema) {\n\t    var result = jsonPath({\n\t        json: jsonSchema,\n\t        path: pathExamples,\n\t        flatten: true,\n\t        wrap: false,\n\t        resultType: 'value'\n\t    });\n\t    return Array.isArray(result) ? result : [result];\n\t}\n\t\n\t/**\n\t * Builds a map with the path to the repsonse-schema as key and the paths to the examples, as value\n\t * @param {Array.<String>}  pathsExamples   Paths to the examples\n\t * @returns {Object.<String, Array.<String>>}   Map with schema-path as key and example-paths as value\n\t * @private\n\t */\n\tfunction _buildValidationMap(pathsExamples) {\n\t    return pathsExamples.reduce(function (validationMap, pathExample) {\n\t        var pathSchema = _getSchemaPathOfExample(pathExample);\n\t        validationMap[pathSchema] = pathExample;\n\t        return validationMap;\n\t    }, {});\n\t}\n\t\n\t/**\n\t * Validates examples against the schema.\n\t * @param {Object}          validator           JSON-schema validator\n\t * @param {Object}          jsonSchema          Swagger-JSON\n\t * @param {String}          pathResponseSchema  Path to the schema of the response\n\t * @param {Array.<String>}  pathsExamples       Examples to validate\n\t * @param {Object}          statistics          Object to contain statistics metrics\n\t * @returns {Array.<Object>}    Array with errors. Empty array, if examples are valid\n\t * @private\n\t */\n\tfunction _validateExamples(_ref2) {\n\t    var validator = _ref2.validator,\n\t        jsonSchema = _ref2.jsonSchema,\n\t        pathResponseSchema = _ref2.pathResponseSchema,\n\t        pathsExamples = _ref2.pathsExamples,\n\t        statistics = _ref2.statistics;\n\t\n\t    var errors = [],\n\t        schema = _getObjectByPath(pathResponseSchema, jsonSchema),\n\t        examples = _getExamples(pathsExamples, jsonSchema);\n\t    statistics.responseExamplesTotal += examples.length;\n\t    // No schema, no validation\n\t    if (!schema) {\n\t        // Examples without schema are considered valid\n\t        statistics.responseSchemasWithExamples--;\n\t        statistics.responseExamplesWithoutSchema++;\n\t        return errors;\n\t    }\n\t    return examples.reduce(function (errors, example, idxExample) {\n\t        var valid = validator.validate(schema, example);\n\t        if (valid) {\n\t            return errors;\n\t        }\n\t        return errors.concat.apply(errors, _toConsumableArray(validator.errors.map(function (error) {\n\t            // Add example-index to path, if necessary\n\t            var pathExample = pathsExamples + (examples.length > 1 ? '[' + idxExample + ']' : '');\n\t            // Convert path-array to JSON-pointer\n\t            error.examplePath = jsonPath.toPointer(jsonPath.toPathArray(pathExample));\n\t            return error;\n\t        })));\n\t    }, errors);\n\t}\n\t\n\tfunction _getSchemaPathOfExample(pathExample) {\n\t    var pathSegs = jsonPath.toPathArray(pathExample).slice(),\n\t        idxExamples = pathSegs.lastIndexOf(PROP__EXAMPLES);\n\t    pathSegs.splice(idxExamples, pathSegs.length - idxExamples, PROP__SCHEMA);\n\t    return jsonPath.toPathString(pathSegs);\n\t}\n\t\n\tfunction _createValidator() {\n\t    return new Ajv({\n\t        allErrors: true\n\t    });\n\t}\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fs\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"jsonpath-plus\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"ajv\");\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// index.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bc91a0c58cf69db78d42","const\n    fs = require('fs'),\n    jsonPath = require('jsonpath-plus'),\n    Ajv = require('ajv');\n\n// PUBLIC API\n\nexport default validateExamples;\nexport {\n    validateFile\n};\n\n// IMPLEMENTATION DETAILS\n\nconst\n    PROP__SCHEMA = 'schema',\n    PROP__EXAMPLES = 'examples',\n    PATH__EXAMPLES = `$..${ PROP__EXAMPLES }.application/json`;\n\n// Public\n\nfunction validateExamples(jsonSchema) {\n    const pathsExamples = _extractExamplePaths(jsonSchema);\n    return _validateExamplesPaths(pathsExamples, jsonSchema);\n}\n\nfunction validateFile(filePath) {\n    const jsonSchema = JSON.parse(fs.readFileSync(filePath, 'utf-8'));\n    return validateExamples(jsonSchema);\n}\n\n// Private\n\nfunction _extractExamplePaths(jsonSchema) {\n    return jsonPath({\n        json: jsonSchema,\n        path: PATH__EXAMPLES,\n        resultType: 'path'\n    });\n}\n\nfunction _validateExamplesPaths(pathsExamples, jsonSchema) {\n    const\n        validator = _createValidator(),\n        validationMap = _buildValidationMap(pathsExamples),\n        schemaPaths = Object.keys(validationMap),\n        statistics = _initStatistics({ schemaPaths }),\n        validationResult = {\n            valid: true,\n            statistics\n        };\n    schemaPaths.forEach(pathResponseSchema => {\n        const\n            pathsExamplesForSchema = validationMap[pathResponseSchema],\n            curErrors = _validateExamples({ validator, jsonSchema, pathResponseSchema,\n                pathsExamples: pathsExamplesForSchema, statistics });\n        if (!curErrors.length) { return; }\n        validationResult.valid = false;\n        let errors = validationResult.errors;\n        if (!errors) {\n            errors = [];\n            validationResult.errors = errors;\n        }\n        validationResult.errors.splice(errors.length - 1, 0, ...curErrors);\n    });\n    return validationResult;\n}\n\nfunction _initStatistics({ schemaPaths }) {\n    return {\n        responseSchemasWithExamples: schemaPaths.length,\n        responseExamplesTotal: 0,\n        responseExamplesWithoutSchema: 0\n    };\n}\n\nfunction _getObjectByPath(path, schema) {\n    return jsonPath({\n        json: schema,\n        path,\n        wrap: false,\n        resultType: 'value'\n    });\n}\n\nfunction _getExamples(pathExamples, jsonSchema) {\n    const result = jsonPath({\n        json: jsonSchema,\n        path: pathExamples,\n        flatten: true,\n        wrap: false,\n        resultType: 'value'\n    });\n    return Array.isArray(result) ? result : [result];\n}\n\n/**\n * Builds a map with the path to the repsonse-schema as key and the paths to the examples, as value\n * @param {Array.<String>}  pathsExamples   Paths to the examples\n * @returns {Object.<String, Array.<String>>}   Map with schema-path as key and example-paths as value\n * @private\n */\nfunction _buildValidationMap(pathsExamples) {\n    return pathsExamples.reduce((validationMap, pathExample) => {\n        const\n            pathSchema = _getSchemaPathOfExample(pathExample);\n        validationMap[pathSchema] = pathExample;\n        return validationMap;\n    }, {});\n}\n\n/**\n * Validates examples against the schema.\n * @param {Object}          validator           JSON-schema validator\n * @param {Object}          jsonSchema          Swagger-JSON\n * @param {String}          pathResponseSchema  Path to the schema of the response\n * @param {Array.<String>}  pathsExamples       Examples to validate\n * @param {Object}          statistics          Object to contain statistics metrics\n * @returns {Array.<Object>}    Array with errors. Empty array, if examples are valid\n * @private\n */\nfunction _validateExamples({ validator, jsonSchema, pathResponseSchema, pathsExamples, statistics }) {\n    const\n        errors = [],\n        schema = _getObjectByPath(pathResponseSchema, jsonSchema),\n        examples = _getExamples(pathsExamples, jsonSchema);\n    statistics.responseExamplesTotal += examples.length;\n    // No schema, no validation\n    if (!schema) {\n        // Examples without schema are considered valid\n        statistics.responseSchemasWithExamples--;\n        statistics.responseExamplesWithoutSchema++;\n        return errors;\n    }\n    return examples.reduce((errors, example, idxExample) => {\n        const valid = validator.validate(schema, example);\n        if (valid) { return errors; }\n        return errors.concat(...validator.errors.map((error) => {\n            // Add example-index to path, if necessary\n            const pathExample = pathsExamples + (examples.length > 1 ? `[${ idxExample }]` : '');\n            // Convert path-array to JSON-pointer\n            error.examplePath = jsonPath.toPointer(jsonPath.toPathArray(pathExample));\n            return error;\n        }));\n    }, errors);\n}\n\nfunction _getSchemaPathOfExample(pathExample) {\n    const\n        pathSegs = jsonPath.toPathArray(pathExample).slice(),\n        idxExamples = pathSegs.lastIndexOf(PROP__EXAMPLES);\n    pathSegs.splice(idxExamples, pathSegs.length - idxExamples, PROP__SCHEMA);\n    return jsonPath.toPathString(pathSegs);\n}\n\nfunction _createValidator() {\n    return new Ajv({\n        allErrors: true\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"jsonpath-plus\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonpath-plus\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"ajv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ajv\"\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}